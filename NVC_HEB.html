<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nonviolent Communication Basics</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;900&display=swap" rel="stylesheet">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-M27LTF4SQG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      // Config will be called later after consent is given.
    </script>

    <style>
        :root {
            --green: #58cc02;
            --light-green: #89e219;
            --yellow: #ffc800;
            --blue: #1cb0f6;
            --light-blue: #88d4f8;
            --red: #ff4b4b;
            --light-red: #ff8989;
            --purple: #9b59b6;
            --border-radius: 16px;
            --button-height: 60px;

            /* Light Theme */
            --bg-primary: #f7f7f7;
            --bg-secondary: #ffffff;
            --text-primary: #4b4b4b;
            --text-secondary: #777777;
            --border-color: #e5e5e5;
            --shadow-color: #00000020;
        }
        
        body.dark-mode {
            /* Dark Theme */
            --bg-primary: #121212;
            --bg-secondary: #1E1E1E;
            --text-primary: #E0E0E0;
            --text-secondary: #A0A0A0;
            --border-color: #333333;
            --shadow-color: #00000040;
        }


        *, *::before, *::after {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 1rem;
            overflow-y: auto;
            transition: background 0.3s, color 0.3s;
        }

        body.rtl { direction: rtl; }

        #app-wrapper {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
        }

        /* --- Header & Progress --- */
        header {
            width: 100%;
            padding: 1rem 0;
            margin-bottom: 1rem;
        }

        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .xp-display, .lives-display {
            font-weight: 900;
            font-size: 1.2rem;
            color: var(--yellow);
            text-shadow: 1px 1px 2px #00000030;
        }
        .lives-display { color: var(--red); letter-spacing: 0.2em; }
        .header-left, .header-right { display: flex; align-items: center; gap: 1rem; }

        .sound-toggle, .theme-toggle, .lang-toggle {
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--text-secondary);
        }
        .lang-toggle.active { color: var(--blue); text-decoration: underline;}


        .progress-bar-container {
            width: 100%;
            height: 20px;
            background-color: var(--border-color);
            border-radius: 10px;
            border: 2px solid var(--border-color);
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--light-blue), var(--blue));
            border-radius: 8px;
            transition: width 0.5s ease-out;
        }
        
        .mini-map-container { display: flex; justify-content: center; align-items: center; gap: 10px; flex-wrap: wrap; }
        .mini-map-group { display: flex; gap: 5px; padding: 4px; border: 1px solid var(--border-color); border-radius: 8px;}
        .mini-map-dot { width: 10px; height: 10px; border-radius: 50%; transition: background-color 0.3s; }
        .mini-map-dot.completed { background-color: var(--green); }
        .mini-map-dot.unlocked { background-color: var(--blue); animation: pulse 1.5s infinite; }
        .mini-map-dot.locked { background-color: var(--border-color); }
        .mini-map-dot.coming-soon { background-color: var(--purple); opacity: 0.5; }

        /* --- Main Content & Map --- */
        #content-area {
            flex-grow: 1;
            width: 100%;
            padding: 1.5rem;
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 24px #0000001a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 400px;
            transition: background 0.3s, border-color 0.3s;
        }

        .map-view {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            padding: 2rem 0;
        }

        .stage-node { position: relative; }

        .stage-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 8px solid var(--bg-secondary);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1), 0 4px 0 var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s, color 0.3s;
            position: relative;
        }
        .stage-button:active {
            transform: translateY(2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1), 0 2px 0 var(--border-color);
        }

        .stage-icon-container { display: flex; align-items: center; justify-content: center; }
        .stage-icon { font-size: 2.5rem; }
        .level-indicator { font-size: 1.2rem; margin-left: 2px; }
        .stage-title-map { font-size: 0.8rem; margin-top: 5px; text-align: center; line-height: 1.2; }

        .stage-button.unlocked { background: var(--blue); color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1), 0 4px 0 #0d7ab3; animation: pulse 1.5s infinite; }
        .stage-button.completed { background: var(--green); color: white; box-shadow: 0 5px 15px rgba(0,0,0,0.1), 0 4px 0 #3a8a00; }
        .stage-button.locked { background: var(--border-color); color: var(--text-secondary); cursor: not-allowed; }
        .stage-button.coming-soon { background: var(--purple); color: white; cursor: not-allowed; opacity: 0.7; }
        
        .giraffe-map-icon { position: absolute; width: 60px; height: 60px; bottom: -30px; left: -50px; transform: rotate(-15deg); transition: all 0.5s ease-in-out; }
        body.rtl .giraffe-map-icon { left: auto; right: -50px; transform: rotate(15deg); }
        
        .level-title { width: 100%; text-align: center; font-size: 1.5rem; font-weight: 900; color: var(--text-secondary); padding-bottom: 1rem; margin-bottom: 2rem; border-bottom: 2px solid var(--border-color); }

        .screen-header { display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 1.5rem; }
        .screen-title { font-size: 1.8rem; font-weight: 900; text-align: center; flex-grow: 1; margin: 0 2rem; }
        .back-to-menu-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary); padding: 0.5rem; line-height: 1; }
        .completion-title { font-size: 1.8rem; font-weight: 900; text-align: center; margin-bottom: 1.5rem; }

        .completion-icon { font-size: 4rem; animation: bounce-in 0.5s ease-out; }
        .lesson-content, .exercise-question { font-size: 1.1rem; line-height: 1.6; text-align: center; margin-bottom: 2rem; }
        .lesson-example { width: 100%; padding: 1rem; background: var(--bg-primary); border-left: 5px solid var(--blue); border-radius: 8px; margin-top: 1.5rem; font-style: italic; transition: background 0.3s; }
        body.rtl .lesson-example { border-left: none; border-right: 5px solid var(--blue); }

        .btn { display: flex; align-items: center; justify-content: center; width: 100%; min-height: var(--button-height); font-family: 'Nunito', sans-serif; font-weight: 700; font-size: 1.1rem; color: var(--text-primary); background-color: var(--bg-secondary); border: 2px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer; padding: 0.5rem 1rem; text-align: center; box-shadow: 0 4px 0 var(--shadow-color); transition: all 0.2s ease; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 0 var(--shadow-color); }
        .btn:active:not(:disabled) { transform: translateY(2px); box-shadow: 0 2px 0 var(--shadow-color); }
        .btn:disabled { cursor: not-allowed; color: var(--text-secondary); }
        .btn-primary { background-color: var(--green); color: white; border-color: var(--green); box-shadow: 0 4px 0 #3a8a00; }
        .btn-primary:hover:not(:disabled) { background-color: var(--light-green); border-color: var(--light-green); }
        .btn.correct { background-color: var(--green); border-color: var(--green); color: white; animation: bounce 0.5s; }
        .btn.incorrect { background-color: var(--light-red); border-color: var(--light-red); color: white; }
        
        footer { width: 100%; position: relative; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-color); }
        
        .giraffe-container { display: flex; align-items: flex-end; gap: 10px; margin-top: 1rem; }
        #giraffe-svg-container { width: 80px; height: auto; flex-shrink: 0; display: flex; justify-content: center; align-items: flex-end; }
        .speech-bubble { position: relative; background: var(--bg-secondary); border-radius: var(--border-radius); padding: 1rem; font-weight: 700; box-shadow: 0 4px 0 var(--shadow-color); border: 1px solid var(--border-color); width: 100%; }
        .speech-bubble::before { content: ''; position: absolute; left: -10px; bottom: 15px; width: 0; height: 0; border: 10px solid transparent; border-right-color: var(--bg-secondary); border-left: 0; border-bottom: 0; margin-top: -5px; margin-left: -10px; transition: border-right-color 0.3s; }
        body.rtl .speech-bubble::before { left: auto; right: -10px; border-right-color: transparent; border-left-color: var(--bg-secondary); border-right: 0; border-left: 10px; margin-left: 0; margin-right: -10px; transition: border-left-color 0.3s; }
        
        #feedback-section { width: 100%; text-align: center; padding: 1rem; }
        .feedback-message { min-height: 80px; border-radius: var(--border-radius); padding: 1rem; margin-bottom: 1rem; font-weight: 700; font-size: 1.2rem; display: none; }
        .feedback-message.correct { display: block; background: #e1f9d3; color: #3a8a00; border-left: 5px solid var(--green); }
        .feedback-message.incorrect { display: block; background: #ffebee; color: #c00c00; border-left: 5px solid var(--red); }
        body.dark-mode .feedback-message.correct { background: #2c4a27; color: #b2d8b2; }
        body.dark-mode .feedback-message.incorrect { background: #5c2c2c; color: #f2c2c2; }
        body.rtl .feedback-message.correct, body.rtl .feedback-message.incorrect { border-left: none; border-right: 5px solid var(--green); }
        body.rtl .feedback-message.incorrect { border-right-color: var(--red); }
        #next-button-container { margin-top: 1rem; width: 100%; max-width: 300px; }

        .matching-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; width:100%; }
        .matching-pair { min-height: var(--button-height); display: flex; align-items: center; justify-content: center; padding: 0.75rem; background: var(--bg-secondary); transition: background 0.3s; border: 2px solid var(--border-color); border-radius: var(--border-radius); box-shadow: 0 4px 0 var(--shadow-color); cursor: grab; user-select: none; font-weight: 700; text-align: center; }
        .matching-pair.selected { background: var(--blue); color: white; border-color: var(--blue); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 1rem;}
        .modal { background: var(--bg-secondary); padding: 2rem; border-radius: var(--border-radius); max-width: 90%; width: 400px; text-align: center; animation: bounce-in 0.4s; }
        .modal h3 { margin-top: 0; color: var(--blue); }
        .modal .btn { margin-top: 1rem; }
        .modal .selection-group { margin: 1.5rem 0; }
        .modal .selection-group p { font-weight: 700; margin-bottom: 0.5rem; }
        .modal .btn-group { display: flex; gap: 1rem; justify-content: center;}
        .modal .btn-group .btn { width: auto; padding: 0.5rem 1.5rem; }
        .modal .btn-group .btn.active { background-color: var(--blue); color: white; }
        #policy-text { text-align: left; max-height: 300px; overflow-y: auto; font-size: 0.9rem; }
        #policy-text a { color: var(--blue); }

        #cookie-consent-banner { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg-secondary); padding: 1rem; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: none; align-items: center; justify-content: center; gap: 1rem; z-index: 2000; text-align: center; flex-wrap: wrap; }
        #cookie-consent-banner p { margin: 0 1rem 0.5rem 1rem; flex-basis: 100%; }
        #cookie-consent-banner .cookie-buttons { display: flex; gap: 1rem; }
        
        .footer-content { text-align: center; }
        .footer-links { margin-bottom: 1rem; }
        .footer-links a, .footer-links button { color: var(--text-secondary); text-decoration: none; margin: 0 0.5rem; font-size: 0.8rem; background: none; border: none; cursor: pointer; padding: 0; }
        .footer-links a:hover, .footer-links button:hover { text-decoration: underline; }
        .completion-actions { margin-top: 1.5rem; display: flex; flex-direction: column; align-items: center; gap: 1rem; width: 100%; max-width: 300px;}
        #reset-progress-btn { font-size: 0.8rem; color: var(--text-secondary); text-decoration: underline; background: none; border: none; cursor: pointer;}
        
        .poem-container { width: 100%; max-width: 500px; display: flex; flex-direction: column; align-items: center; gap: 1.5rem; }
        .poem-image { width: 100%; height: auto; border-radius: var(--border-radius); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }

        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes bounce-in { 0% { transform: scale(0.7); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .confetti { position: fixed; top: -10px; width: 10px; height: 10px; opacity: 0.8; animation: fall 3s linear infinite; }
        @keyframes fall { to { transform: translateY(100vh); opacity: 0; } }
        
        @media (max-width: 600px) { body { padding: 0.5rem; } #content-area { padding: 1rem; } .screen-title { font-size: 1.5rem; } .lesson-content, .exercise-question { font-size: 1rem; } .btn { font-size: 1rem; } .matching-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div id="welcome-modal-overlay" class="modal-overlay">
        <div class="modal">
            <h3 id="welcome-title"></h3>
            <p id="welcome-text"></p>

            <div class="selection-group">
                 <p id="lang-select-label">Language</p>
                 <div class="btn-group">
                    <button id="lang-btn-en" class="btn active">English</button>
                    <button id="lang-btn-he" class="btn">×¢×‘×¨×™×ª</button>
                 </div>
            </div>

            <button id="start-course-btn" class="btn btn-primary"></button>
        </div>
    </div>
    
    <div id="policy-modal-overlay" class="modal-overlay">
        <div class="modal">
            <h3 id="policy-title"></h3>
            <div id="policy-text"></div>
            <button id="close-policy-btn" class="btn btn-primary"></button>
        </div>
    </div>
    
    <div id="reset-confirm-modal-overlay" class="modal-overlay">
        <div class="modal">
            <h3 id="reset-confirm-title"></h3>
            <p id="reset-confirm-text"></p>
            <div class="btn-group">
                <button id="confirm-reset-btn" class="btn"></button>
                <button id="cancel-reset-btn" class="btn btn-primary"></button>
            </div>
        </div>
    </div>
   
    <div id="app-wrapper">
        <header>
            <div class="header-controls">
                <div class="header-left">
                     <div class="xp-display">â¤ï¸ 0</div>
                </div>
                <div class="header-right">
                    <div id="lives-display" class="lives-display"></div>
                    <button id="theme-toggle" class="theme-toggle">ğŸŒ™</button>
                    <button id="sound-toggle" class="sound-toggle">ğŸ”Š</button>
                </div>
            </div>
            <div class="progress-bar-container">
                <div id="progress-bar" class="progress-bar"></div>
            </div>
            <div id="mini-map-container" class="mini-map-container"></div>
        </header>

        <main id="content-area"></main>

        <footer>
            <div class="footer-content">
                <div class="footer-links">
                    <a href="#" id="support-link" target="_blank"></a>
                    <a href="#" id="terms-link"></a>
                    <a href="#" id="privacy-link"></a>
                </div>
                <div class="giraffe-container">
                    <div id="giraffe-svg-container">
                        <!-- Giraffe SVG will be injected here by JavaScript -->
                    </div>
                    <div id="giraffe-speech" class="speech-bubble"></div>
                </div>
            </div>
        </footer>
    </div>
    
    <div id="cookie-consent-banner">
        <p id="cookie-text"></p>
        <div class="cookie-buttons">
            <button id="accept-cookies-btn" class="btn btn-primary"></button>
            <button id="decline-cookies-btn" class="btn"></button>
        </div>
    </div>
    
    <script>
        const contentArea = document.getElementById('content-area');
        const progressBar = document.getElementById('progress-bar');
        const xpDisplay = document.querySelector('.xp-display');
        const livesDisplay = document.getElementById('lives-display');
        const soundToggle = document.getElementById('sound-toggle');
        const themeToggle = document.getElementById('theme-toggle');
        const giraffeSpeech = document.getElementById('giraffe-speech');
        const giraffeSvgContainer = document.getElementById('giraffe-svg-container');
        
        // Modal elements
        const welcomeModalOverlay = document.getElementById('welcome-modal-overlay');
        const welcomeTitle = document.getElementById('welcome-title');
        const welcomeText = document.getElementById('welcome-text');
        const langSelectLabel = document.getElementById('lang-select-label');
        const langBtnEn = document.getElementById('lang-btn-en');
        const langBtnHe = document.getElementById('lang-btn-he');
        const startCourseBtn = document.getElementById('start-course-btn');

        // Policy Modal
        const policyModalOverlay = document.getElementById('policy-modal-overlay');
        const policyTitle = document.getElementById('policy-title');
        const policyText = document.getElementById('policy-text');
        const closePolicyBtn = document.getElementById('close-policy-btn');

        // Reset Confirm Modal
        const resetConfirmModalOverlay = document.getElementById('reset-confirm-modal-overlay');
        const resetConfirmTitle = document.getElementById('reset-confirm-title');
        const resetConfirmText = document.getElementById('reset-confirm-text');
        const confirmResetBtn = document.getElementById('confirm-reset-btn');
        const cancelResetBtn = document.getElementById('cancel-reset-btn');

        // Cookie Banner
        const cookieBanner = document.getElementById('cookie-consent-banner');
        const cookieText = document.getElementById('cookie-text');
        const acceptCookiesBtn = document.getElementById('accept-cookies-btn');
        const declineCookiesBtn = document.getElementById('decline-cookies-btn');

        // Footer Links
        const supportLink = document.getElementById('support-link');
        const termsLink = document.getElementById('terms-link');
        const privacyLink = document.getElementById('privacy-link');

        // --- Giraffe SVGs representing growth ---
        const giraffeSVGs = [
            // Stage 0: Baby
            `<svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M58 83C58 88.5228 54.5228 93 50 93C45.4772 93 42 88.5228 42 83C42 77.4772 45.4772 73 50 73C54.5228 73 58 77.4772 58 83Z" fill="#FBBF24"/><path d="M45 52C45 50.3431 46.3431 49 48 49H52C53.6569 49 55 50.3431 55 52V73H45V52Z" fill="#FCD34D"/><path d="M51.5 39C51.5 35.6863 48.8137 33 45.5 33C42.1863 33 39.5 35.6863 39.5 39V50H51.5V39Z" fill="#FCD34D"/><circle cx="43" cy="40" r="2" fill="black"/><path d="M41 33C41 31.8954 41.8954 31 43 31H44C45.1046 31 46 31.8954 46 33V35H41V33Z" fill="#D97706"/><path d="M49 33C49 31.8954 49.8954 31 51 31H52C53.1046 31 54 31.8954 54 33V35H49V33Z" fill="#D97706"/><circle cx="47" cy="60" r="3" fill="#F59E0B"/><circle cx="53" cy="77" r="4" fill="#F59E0B"/></svg>`,
            // Stage 1: Toddler
            `<svg viewBox="0 0 100 110" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M60 90C60 95.5228 56.5228 100 52 100C47.4772 100 44 95.5228 44 90C44 84.4772 47.4772 80 52 80C56.5228 80 60 84.4772 60 90Z" fill="#FBBF24"/><path d="M47 50C47 48.3431 48.3431 47 50 47H54C55.6569 47 57 48.3431 57 50V80H47V50Z" fill="#FCD34D"/><path d="M53.5 32C53.5 28.6863 50.8137 26 47.5 26C44.1863 26 41.5 28.6863 41.5 32V48H53.5V32Z" fill="#FCD34D"/><circle cx="45" cy="33" r="2" fill="black"/><path d="M43 26C43 24.8954 43.8954 24 45 24H46C47.1046 24 48 24.8954 48 26V28H43V26Z" fill="#D97706"/><path d="M51 26C51 24.8954 51.8954 24 53 24H54C55.1046 24 56 24.8954 56 26V28H51V26Z" fill="#D97706"/><circle cx="49" cy="65" r="3.5" fill="#F59E0B"/><circle cx="55" cy="84" r="4.5" fill="#F59E0B"/><circle cx="49" cy="93" r="3" fill="#F59E0B"/></svg>`,
            // Stage 2: Youth
            `<svg viewBox="0 0 100 120" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M62 97C62 102.523 58.5228 107 54 107C49.4772 107 46 102.523 46 97C46 91.4772 49.4772 87 54 87C58.5228 87 62 91.4772 62 97Z" fill="#FBBF24"/><path d="M49 48C49 46.3431 50.3431 45 52 45H56C57.6569 45 59 46.3431 59 48V87H49V48Z" fill="#FCD34D"/><path d="M55.5 25C55.5 21.6863 52.8137 19 49.5 19C46.1863 19 43.5 21.6863 43.5 25V46H55.5V25Z" fill="#FCD34D"/><circle cx="47" cy="26" r="2" fill="black"/><path d="M45 19C45 17.8954 45.8954 17 47 17H48C49.1046 17 50 17.8954 50 19V21H45V19Z" fill="#D97706"/><path d="M53 19C53 17.8954 53.8954 17 55 17H56C57.1046 17 58 17.8954 58 19V21H53V19Z" fill="#D97706"/><circle cx="51" cy="70" r="4" fill="#F59E0B"/><circle cx="57" cy="91" r="5" fill="#F59E0B"/><circle cx="51" cy="55" r="3" fill="#F59E0B"/></svg>`,
             // Stage 3 & 4: Teen / Adult
            `<svg viewBox="0 0 100 130" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M64 104C64 109.523 60.5228 114 56 114C51.4772 114 48 109.523 48 104C48 98.4772 51.4772 94 56 94C60.5228 94 64 98.4772 64 104Z" fill="#FBBF24"/><path d="M51 46C51 44.3431 52.3431 43 54 43H58C59.6569 43 61 44.3431 61 46V94H51V46Z" fill="#FCD34D"/><path d="M57.5 18C57.5 14.6863 54.8137 12 51.5 12C48.1863 12 45.5 14.6863 45.5 18V44H57.5V18Z" fill="#FCD34D"/><circle cx="49" cy="19" r="2" fill="black"/><path d="M47 12C47 10.8954 47.8954 10 49 10H50C51.1046 10 52 10.8954 52 12V14H47V12Z" fill="#D97706"/><path d="M55 12C55 10.8954 55.8954 10 57 10H58C59.1046 10 60 10.8954 60 12V14H55V12Z" fill="#D97706"/><circle cx="53" cy="75" r="4" fill="#F59E0B"/><circle cx="59"cy="98" r="5" fill="#F59E0B"/><circle cx="53" cy="58" r="3.5" fill="#F59E0B"/><circle cx="58" cy="108" r="3" fill="#F59E0B"/></svg>`
        ];

        let audioCtx;
        function initAudio() { if (!audioCtx) { try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } catch (e) { console.error("Web Audio API not supported."); } } }
        function playSound(type) {
            if (!audioCtx || state.isMuted) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const o = audioCtx.createOscillator(), g = audioCtx.createGain();
            o.connect(g); g.connect(audioCtx.destination);
            if (type === 'correct') { o.type = 'sine'; o.frequency.setValueAtTime(600, audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1); g.gain.setValueAtTime(0.2, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2); o.start(); o.stop(audioCtx.currentTime + 0.2); }
            else if (type === 'incorrect') { o.type = 'square'; o.frequency.setValueAtTime(200, audioCtx.currentTime); o.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.2); g.gain.setValueAtTime(0.2, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.3); o.start(); o.stop(audioCtx.currentTime + 0.3); }
            else if (type === 'streak' || type === 'moduleComplete') { const notes = type === 'streak' ? [600, 750, 900] : [523, 659, 783, 1046]; g.gain.setValueAtTime(0.15, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.5); notes.forEach((n, i) => { const o2 = audioCtx.createOscillator(); o2.connect(g); o2.type = 'triangle'; o2.frequency.setValueAtTime(n, audioCtx.currentTime + i * 0.1); o2.start(audioCtx.currentTime + i * 0.1); o2.stop(audioCtx.currentTime + i * 0.1 + 0.1); }); }
        }

        let state = {};
        const defaultState = {
            view: 'map',
            lang: 'he', // Default to Hebrew
            theme: 'light',
            activeModule: { id: null, screen: 0, lives: 3, completedExercises: [] },
            xp: 0,
            streak: 0,
            isMuted: false,
            completedModules: []
        };
        
        const courseContent = {
            en: {
                welcomeTitle: "Welcome to Compassionate Communication!",
                welcomeText: "Join me on a journey to learn Nonviolent Communication (NVC). We'll learn to connect more deeply with ourselves and others.",
                langSelectLabel: "Language",
                letsGo: "Let's Begin ğŸŒ±",
                gotIt: "Got it!",
                mapSpeech: "Wonderful! When you're ready, select the next step on our path.",
                stageSpeech: "Let's look at this together.",
                moduleComplete: "Step Complete!",
                outOfTries: "It's okay to stumble.",
                outOfTriesMsg: "That was tricky! Every attempt is a chance to learn. Let's try this step again from the beginning.",
                tryAgain: "Try Again",
                continue: "Continue",
                continueToMap: "Continue to Map",
                backToMenu: "Back to Menu",
                finalTitle: "You've learned the core path! ï¿½",
                finalContent: "Congratulations! You've walked through the four steps of NVC. You now have the tools to express yourself honestly and listen with compassion. This is a lifelong practice.",
                finalBot: "Your heart is speaking so clearly! ğŸ’–",
                feedbackCTA: "Give Feedback & Get Updates",
                supportProject: "Support this project",
                terms: "Terms of Use",
                privacy: "Privacy Policy",
                resetProgress: "Reset Progress",
                cookieText: "We use cookies to improve your experience and analyze site traffic.",
                accept: "Accept",
                decline: "Decline",
                close: "Close",
                resetConfirmTitle: "Are you sure?",
                resetConfirmText: "This will permanently delete all your progress.",
                confirmReset: "Yes, Reset",
                cancel: "Cancel",
                comingSoon: "Coming soon: Content for children and parents!",
                supportCTA: "If you found value in this journey, your support helps this project grow. Any amount is greatly appreciated.",
            },
            he: {
                welcomeTitle: "×‘×¨×•×›×™× ×”×‘××™× ×œ×ª×§×©×•×¨×ª ××§×¨×‘×ª!",
                welcomeText: "×”×¦×˜×¨×¤×• ××œ×™×™ ×œ××¡×¢ ×œ×œ×™××•×“ ×ª×§×©×•×¨×ª ××§×¨×‘×ª (NVC). × ×œ××“ ×œ×”×ª×—×‘×¨ ×œ×¢×¦×× ×• ×•×œ××—×¨×™× ×‘××•×¤×Ÿ ×¢××•×§ ×™×•×ª×¨.",
                langSelectLabel: "×©×¤×”",
                letsGo: "×‘×•××• × ×ª×—×™×œ ğŸŒ±",
                gotIt: "×”×‘× ×ª×™!",
                mapSpeech: "× ×”×“×¨! ×›×©×ª×”×™×• ××•×›× ×™×, ×‘×—×¨×• ××ª ×”×¦×¢×“ ×”×‘× ×‘×“×¨×›× ×•.",
                stageSpeech: "×‘×•××• × ×‘×—×Ÿ ××ª ×–×” ×™×—×“.",
                moduleComplete: "×”×©×œ×‘ ×”×•×©×œ×!",
                outOfTries: "×–×” ×‘×¡×“×¨ ×œ××¢×•×“.",
                outOfTriesMsg: "×–×” ×”×™×” ×××ª×’×¨! ×›×œ × ×™×¡×™×•×Ÿ ×”×•× ×”×–×“×× ×•×ª ×œ×œ××•×“. ×‘×•××• × × ×¡×” ××ª ×”×©×œ×‘ ×”×–×” ×©×•×‘ ××”×”×ª×—×œ×”.",
                tryAgain: "×œ× ×¡×•×ª ×©×•×‘",
                continue: "×”××©×š",
                continueToMap: "×”××©×š ×œ××¤×”",
                backToMenu: "×—×–×¨×” ×œ×ª×¤×¨×™×˜",
                empathyTitle: "×××¤×ª×™×” ×‘×¤×¢×•×œ×”",
                finalTitle: "×œ××“×ª× ××ª ×©×‘×™×œ ×”×œ×™×‘×”! ğŸ‰",
                finalContent: "×›×œ ×”×›×‘×•×“! ×¢×‘×¨×ª× ×“×¨×š ××¨×‘×¢×ª ×”×¦×¢×“×™× ×©×œ ×ª×§×©×•×¨×ª ××§×¨×‘×ª. ×›×¢×ª ×™×© ×œ×›× ×›×œ×™× ×œ×”×‘×™×¢ ××ª ×¢×¦××›× ×‘×›× ×•×ª ×•×œ×”×§×©×™×‘ ×‘×—××œ×”. ×–×•×”×™ ×“×¨×š ×—×™×™×.",
                finalBot: "×”×œ×‘ ×©×œ×›× ××“×‘×¨ ×›×œ ×›×š ×‘×¨×•×¨! ğŸ’–",
                feedbackCTA: "××ª×Ÿ ××©×•×‘ ×•×§×‘×œ×ª ×¢×“×›×•× ×™×",
                supportProject: "×ª××›×• ×‘×¤×¨×•×™×§×˜",
                terms: "×ª× ××™ ×©×™××•×©",
                privacy: "××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª",
                resetProgress: "××™×¤×•×¡ ×”×ª×§×“××•×ª",
                cookieText: "×× ×• ××©×ª××©×™× ×‘×¢×•×’×™×•×ª (cookies) ×›×“×™ ×œ×©×¤×¨ ××ª ×—×•×•×™×ª ×”××©×ª××© ×•×œ× ×ª×— ××ª ×ª×¢×‘×•×¨×ª ×”××ª×¨.",
                accept: "××™×©×•×¨",
                decline: "×¡×™×¨×•×‘",
                close: "×¡×’×™×¨×”",
                resetConfirmTitle: "×”×× ××ª× ×‘×˜×•×—×™×?",
                resetConfirmText: "×¤×¢×•×œ×” ×–×• ×ª××—×§ ××ª ×›×œ ×”×”×ª×§×“××•×ª ×©×œ×›× ×œ×¦××™×ª×•×ª.",
                confirmReset: "×›×Ÿ, ××¤×¡×•",
                cancel: "×‘×™×˜×•×œ",
                comingSoon: "×‘×§×¨×•×‘: ×ª×›× ×™× ×œ×”×•×¨×™× ×•×™×œ×“×™×!",
                supportCTA: "×× ××¦××ª× ×¢×¨×š ×‘××¡×¢ ×”×–×”, ×ª××™×›×ª×›× ×ª×¢×–×•×¨ ×œ×¤×¨×•×™×§×˜ ×œ×¦××•×—. ×›×œ ×¡×›×•× ×™×ª×§×‘×œ ×‘×‘×¨×›×”.",
            }
        };

        const modules = [
            // Observations
            { id: 1, parent: {en: 'Observations', he: '×”×‘×—× ×•×ª'}, level: 1, icon: "ğŸ”¬", title: {en: 'Basics', he: '×™×¡×•×“×•×ª'}, screens: [
                { type: 'lesson', title: {en: "Meet the Giraffe", he: "×”×›×™×¨×• ××ª ×”×’'×™×¨×£"}, content: { en: "In NVC, the giraffe symbolizes compassionate communication. It has a long neck to see from a clear perspective and a big heart. I'll be your guide!", he: "×‘×ª×§×©×•×¨×ª ××§×¨×‘×ª, ×”×’'×™×¨×£ ××¡××œ ×ª×§×©×•×¨×ª ×—×•××œ×ª. ×™×© ×œ×• ×¦×•×•××¨ ××¨×•×š ×›×“×™ ×œ×¨××•×ª ××¤×¨×¡×¤×§×˜×™×‘×” ×¨×—×‘×” ×•×œ×‘ ×’×“×•×œ. ×× ×™ ××”×™×” ×”××“×¨×™×š ×©×œ×›×!" } },
                { type: 'lesson', title: {en: 'Observation vs. Evaluation', he: '×”×‘×—× ×” ××•×œ ×”×¢×¨×›×”'}, content: {en: "The first step is to observe what is actually happening, free of judgment. We state facts, like a camera.", he: "×”×¦×¢×“ ×”×¨××©×•×Ÿ ×”×•× ×œ×”×‘×—×™×Ÿ ×‘××” ×©×§×•×¨×” ×‘×¤×•×¢×œ, ×œ×œ× ×©×™×¤×•×˜. ×× ×—× ×• ××¦×™×™× ×™× ×¢×•×‘×“×•×ª, ×›××™×œ×• ×”×™×™× ×• ××¦×œ××”."}, example: {en: "Evaluation: 'You're so messy.'\nObservation: 'I see socks on the floor.'", he: "×”×¢×¨×›×”: '××ª×” ×›×œ ×›×š ××‘×•×œ×’×Ÿ.'\n×”×‘×—× ×”: '×× ×™ ×¨×•××” ×’×¨×‘×™×™× ×¢×œ ×”×¨×¦×¤×”.'"} },
                { type: 'exercise', subType: 'ab-test', question: {en:"Which is an observation?", he: "××™×–×• ×××™×¨×” ×”×™× ×”×‘×—× ×”?"}, options: [{text: {en:'You never listen.', he: '××ª×” ××£ ×¤×¢× ×œ× ××§×©×™×‘.'}, correct: false}, {text: {en:'You were looking at your phone while I was talking.', he: '×”×¡×ª×›×œ×ª ×‘×˜×œ×¤×•×Ÿ ×©×œ×š ×›×©×“×™×‘×¨×ª×™.'}, correct: true}], feedback: {correct: {en:"Exactly! That describes a specific action without judgment.", he: "×‘×“×™×•×§! ×–×” ××ª××¨ ×¤×¢×•×œ×” ×¡×¤×¦×™×¤×™×ª ×œ×œ× ×©×™×¤×•×˜."}, incorrect: {en:"'Never' is an evaluation. The other option states what was seen.", he: "'××£ ×¤×¢×' ×”×™× ×”×¢×¨×›×”. ×”××¤×©×¨×•×ª ×”×©× ×™×™×” ××¦×™×™× ×ª ××” ×©× ×¨××”."}} },
                { type: 'exercise', subType: 'ab-test', question: {en:"Which is an evaluation?", he: "××™×–×• ×××™×¨×” ×”×™× ×”×¢×¨×›×”?"}, options: [{text: {en:"The music is playing at 80 decibels.", he: "×”××•×–×™×§×” ××ª× ×’× ×ª ×‘×¢×•×¦××” ×©×œ 80 ×“×¦×™×‘×œ×™×."}, correct: false}, {text: {en:'The music is too loud.', he: '×”××•×–×™×§×” ×¨×•×¢×©×ª ××“×™.'}, correct: true}], feedback: {correct: {en:"Yes, 'too loud' is a subjective judgment.", he: "×›×Ÿ, '×¨×•×¢×©×ª ××“×™' ×”×•× ×©×™×¤×•×˜ ×¡×•×‘×™×™×§×˜×™×‘×™."}, incorrect: {en:"Measuring decibels is a factual observation.", he: "××“×™×“×ª ×“×¦×™×‘×œ×™× ×”×™× ×”×‘×—× ×” ×¢×•×‘×“×ª×™×ª."}} },
                { type: 'exercise', subType: 'mcq', question: {en:"'He is a good soccer player.' Is this an observation or evaluation?", he: "'×”×•× ×©×—×§×Ÿ ×›×“×•×¨×’×œ ×˜×•×‘'. ×”×× ×–×• ×”×‘×—× ×” ××• ×”×¢×¨×›×”?"}, options: [{text: {en:'Observation', he: '×”×‘×—× ×”'}, correct: false}, {text: {en:'Evaluation', he: '×”×¢×¨×›×”'}, correct: true}], feedback: {correct: {en:"Correct. 'Good' is an evaluation. An observation would be 'He scored three goals.'", he: "× ×›×•×Ÿ. '×˜×•×‘' ×”×™× ×”×¢×¨×›×”. ×”×‘×—× ×” ×ª×”×™×” '×”×•× ×”×‘×§×™×¢ ×©×œ×•×©×” ×©×¢×¨×™×'."}, incorrect: {en:"'Good' is a judgment, not a neutral fact.", he: "'×˜×•×‘' ×”×•× ×©×™×¤×•×˜, ×œ× ×¢×•×‘×“×” × ×™×˜×¨×œ×™×ª."}} },
                { type: 'exercise', subType: 'ab-test', question: {en:"Which is an observation?", he: "××™×–×• ×××™×¨×” ×”×™× ×”×‘×—× ×”?"}, options: [{text: {en:"She is procrastinating.", he: "×”×™× ×“×•×—×” ×“×‘×¨×™×."}, correct: false}, {text: {en:"She said she would finish the report yesterday, and I see it is not in my inbox.", he: "×”×™× ×××¨×” ×©×ª×¡×™×™× ××ª ×”×“×•×— ××ª××•×œ, ×•×× ×™ ×¨×•××” ×©×”×•× ×œ× ×‘×ª×™×‘×ª ×”×“×•××¨ ×”× ×›× ×¡ ×©×œ×™."}, correct: true}], feedback: {correct: {en:"That's it. It states the facts without interpreting them as 'procrastinating'.", he: "×–×”×• ×–×”. ×”×××™×¨×” ××¦×™×™× ×ª ××ª ×”×¢×•×‘×“×•×ª ××‘×œ×™ ×œ×¤×¨×© ××•×ª×Ÿ ×›'×“×—×™×™× ×•×ª'."}, incorrect: {en:"'Procrastinating' is a label, an evaluation of behavior.", he: "'×“×—×™×™× ×•×ª' ×”×™× ×ª×•×•×™×ª, ×”×¢×¨×›×” ×©×œ ×”×ª× ×”×’×•×ª."}} },
                { type: 'exercise', subType: 'mcq', question: {en:"What is the main goal of sharing an observation first?", he: "××” ×”××˜×¨×” ×”×¢×™×§×¨×™×ª ×©×œ ×©×™×ª×•×£ ×”×‘×—× ×” ×ª×—×™×œ×”?"}, options: [{text: {en:"To prove you are right.", he: "×œ×”×•×›×™×— ×©××ª×” ×¦×•×“×§."}, correct: false}, {text: {en:"To create a shared reality with the other person.", he: "×œ×™×¦×•×¨ ××¦×™××•×ª ××©×•×ª×¤×ª ×¢× ×”××“× ×”××—×¨."}, correct: true}, {text: {en:"To show them what they did wrong.", he: "×œ×”×¨××•×ª ×œ×”× ××” ×”× ×¢×©×• ×œ× ×‘×¡×“×¨."}, correct: false}], feedback: {correct: {en:"Exactly! Starting with a neutral, shared fact makes it easier for others to listen.", he: "×‘×“×™×•×§! ×”×ª×—×œ×” ×¢× ×¢×•×‘×“×” × ×™×˜×¨×œ×™×ª ×•××©×•×ª×¤×ª ××§×œ×” ×¢×œ ××—×¨×™× ×œ×”×§×©×™×‘."}, incorrect: {en:"The goal is connection, not being right. Starting with a neutral fact helps build that connection.", he: "×”××˜×¨×” ×”×™× ×—×™×‘×•×¨, ×œ× ×œ×”×™×•×ª ×¦×•×“×§. ×”×ª×—×œ×” ×¢× ×¢×•×‘×“×” × ×™×˜×¨×œ×™×ª ×¢×•×–×¨×ª ×œ×‘× ×•×ª ××ª ×”×—×™×‘×•×¨ ×”×–×”."}} },
            ]},
            { id: 2, parent: {en: 'Observations', he: '×”×‘×—× ×•×ª'}, level: 2, icon: "ğŸ”¬", title: {en: 'Basics+', he: '×™×¡×•×“×•×ª+'}, screens: [
                { type: 'lesson', title: {en: 'Avoiding Generalizations', he: '×”×™×× ×¢×•×ª ××”×›×œ×œ×•×ª'}, content: {en: "Words like 'always,' 'never,' 'often,' or 'seldom' usually signal an evaluation disguised as an observation.", he: "××™×œ×™× ×›××• '×ª××™×“', '××£ ×¤×¢×', '×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª' ××• '×œ×¤×¢××™×' ×‘×“×¨×š ×›×œ×œ ××¡×× ×•×ª ×”×¢×¨×›×” ×”××—×•×¤×©×ª ×œ×”×‘×—× ×”."}, example: {en:"Evaluation: 'You are always late.'\nObservation: 'The last three times we met, you arrived after our agreed time.'", he:"×”×¢×¨×›×”: '××ª×” ×ª××™×“ ×××—×¨.'\n×”×‘×—× ×”: '×‘×©×œ×•×© ×”×¤×¢××™× ×”××—×¨×•× ×•×ª ×©× ×¤×’×©× ×•, ×”×’×¢×ª ××—×¨×™ ×”×©×¢×” ×©×§×‘×¢× ×•.'"} },
                { type: 'exercise', subType: 'mcq', question: {en:"Which word signals an evaluation?", he: "××™×–×• ××™×œ×” ××¡×× ×ª ×”×¢×¨×›×”?"}, options: [{text: {en:'always', he: '×ª××™×“'}, correct: true}, {text: {en:'saw', he: '×¨××™×ª×™'}, correct: false}, {text: {en:'heard', he: '×©××¢×ª×™'}, correct: false}], feedback: {correct: {en:"Correct! Generalizations like 'always' are evaluations.", he: "× ×›×•×Ÿ! ×”×›×œ×œ×•×ª ×›××• '×ª××™×“' ×”×Ÿ ×”×¢×¨×›×•×ª."}, incorrect: {en:"'Saw' and 'heard' point to direct observations.", he: "'×¨××™×ª×™' ×•'×©××¢×ª×™' ××¦×‘×™×¢×•×ª ×¢×œ ×”×‘×—× ×•×ª ×™×©×™×¨×•×ª."}} },
                { type: 'exercise', subType: 'matching', question: {en: "Match the statement to its type.", he: "×”×ª×× ××ª ×”×××™×¨×” ×œ×¡×•×’ ×©×œ×”."}, pairs: [{item1: {en: "He is generous.", he: "×”×•× × ×“×™×‘."}, item2: {en: "Evaluation", he: "×”×¢×¨×›×”"}}, {item1: {en: "She arrived at 9:05.", he: "×”×™× ×”×’×™×¢×” ×‘-9:05."}, item2: {en: "Observation", he: "×”×‘×—× ×”"}}, {item1: {en: "You work too much.", he: "××ª×” ×¢×•×‘×“ ×™×•×ª×¨ ××“×™."}, item2: {en: "Evaluation", he: "×”×¢×¨×›×”"}}], feedback: {correct: {en: "Great job distinguishing between what you see and what you think about it!", he: "×¢×‘×•×“×” × ×”×“×¨×ª ×‘×”×‘×—× ×” ×‘×™×Ÿ ××” ×©××ª× ×¨×•××™× ×œ×‘×™×Ÿ ××” ×©××ª× ×—×•×©×‘×™× ×¢×œ ×–×”!"}, incorrect: {en: "Let's try again. An observation is just the facts, an evaluation adds a judgment.", he: "×‘×•××• × × ×¡×” ×©×•×‘. ×”×‘×—× ×” ×”×™× ×¨×§ ×”×¢×•×‘×“×•×ª, ×”×¢×¨×›×” ××•×¡×™×¤×” ×©×™×¤×•×˜."}} },
                { type: 'lesson', title: {en: 'Quotes as Observations', he: '×¦×™×˜×•×˜×™× ×›×”×‘×—× ×•×ª'}, content: {en: "Quoting someone directly is a very powerful form of observation. It removes interpretation.", he: "×œ×¦×˜×˜ ××™×©×”×• ×™×©×™×¨×•×ª ×–×• ×¦×•×¨×” ×—×–×§×” ×××•×“ ×©×œ ×”×‘×—× ×”. ×–×” ××¡×™×¨ ×¤×¨×©× ×•×ª."}, example: {en:"Interpretation: 'He was angry.'\nObservation: 'He said, \"I am so frustrated right now!\" in a loud voice.'", he:"×¤×¨×©× ×•×ª: '×”×•× ×›×¢×¡.'\n×”×‘×—× ×”: '×”×•× ×××¨, \"×× ×™ ×›×œ ×›×š ××ª×•×¡×›×œ ×¢×›×©×™×•!\" ×‘×§×•×œ ×¨×.'"} },
                { type: 'exercise', subType: 'ab-test', question: {en:"Which is a better observation?", he: "××™×–×• ×”×‘×—× ×” ×˜×•×‘×” ×™×•×ª×¨?"}, options: [{text: {en:'You were rude.', he: '×”×™×™×ª ×’×¡ ×¨×•×—.'}, correct: false}, {text: {en:"You said 'That's a stupid idea.'", he: '×××¨×ª "×–×” ×¨×¢×™×•×Ÿ ×˜×™×¤×©×™".'}, correct: true}], feedback: {correct: {en:"Exactly. Quoting is precise.", he: "×‘×“×™×•×§. ×¦×™×˜×•×˜ ×”×•× ××“×•×™×§."}, incorrect: {en:"'Rude' is a judgment. Quoting the exact words is an observation.", he: "'×’×¡ ×¨×•×—' ×–×” ×©×™×¤×•×˜. ×¦×™×˜×•×˜ ×”××™×œ×™× ×”××“×•×™×§×•×ª ×”×•× ×”×‘×—× ×”."}} },
                { type: 'exercise', subType: 'ab-test', question: {en:"Which observation is free of prediction?", he: "××™×–×• ×”×‘×—× ×” × ×˜×•×œ×ª ×—×™×–×•×™?"}, options: [{text: {en:"If you don't study, you will fail the test.", he: "×× ×œ× ×ª×œ××“, ×ª×™×›×©×œ ×‘××‘×—×Ÿ."}, correct: false}, {text: {en:"I see you haven't opened the book today.", he: "×× ×™ ×¨×•××” ×©×œ× ×¤×ª×—×ª ××ª ×”×¡×¤×¨ ×”×™×•×."}, correct: true}], feedback: {correct: {en:"Correct. Predicting the future is an evaluation, not an observation of the present.", he: "× ×›×•×Ÿ. ×—×™×–×•×™ ×”×¢×ª×™×“ ×”×•× ×”×¢×¨×›×”, ×œ× ×”×‘×—× ×” ×©×œ ×”×”×•×•×”."}, incorrect: {en:"'You will fail' is a prediction, which is a type of evaluation.", he: "'×ª×™×›×©×œ' ×–×” ×—×™×–×•×™, ×©×–×” ×¡×•×’ ×©×œ ×”×¢×¨×›×”."}} },
            ]},
            { id: 3, parent: {en: 'Observations', he: '×”×‘×—× ×•×ª'}, level: 3, icon: "ğŸ”¬", title: {en: 'Advanced', he: '××ª×§×“×'}, screens: [
                { type: 'lesson', title: {en: 'Subtle Evaluations', he: '×”×¢×¨×›×•×ª ×¢×“×™× ×•×ª'}, content: {en: "Sometimes evaluations hide in seemingly innocent words. Adjectives like 'good,' 'bad,' 'beautiful,' or 'ugly' are almost always evaluations.", he: "×œ×¤×¢××™× ×”×¢×¨×›×•×ª ××¡×ª×ª×¨×•×ª ×‘××™×œ×™× ×ª××™××•×ª ×œ××¨××”. ×©××•×ª ×ª×•××¨ ×›××• '×˜×•×‘', '×¨×¢', '×™×¤×”' ××• '××›×•×¢×¨' ×”× ×›××¢×˜ ×ª××™×“ ×”×¢×¨×›×•×ª."} },
                { type: 'exercise', subType: 'mcq', question: {en:"'That painting is beautiful.' Observation or evaluation?", he: "'×”×¦×™×•×¨ ×”×–×” ×™×¤×”.' ×”×‘×—× ×” ××• ×”×¢×¨×›×”?"}, options: [{text: {en:'Observation', he: '×”×‘×—× ×”'}, correct: false}, {text: {en:'Evaluation', he: '×”×¢×¨×›×”'}, correct: true}], feedback: {correct: {en:"Correct. Beauty is in the eye of the beholder. An observation might be 'The painting has blue and yellow colors.'", he: "× ×›×•×Ÿ. ×™×•×¤×™ ×”×•× ×‘×¢×™× ×™ ×”××ª×‘×•× ×Ÿ. ×”×‘×—× ×” ×™×›×•×œ×” ×œ×”×™×•×ª '×‘×¦×™×•×¨ ×™×© ×¦×‘×¢×™× ×›×—×•×œ×™× ×•×¦×”×•×‘×™×'."}, incorrect: {en:"'Beautiful' is a personal judgment, not a verifiable fact.", he: "'×™×¤×”' ×”×•× ×©×™×¤×•×˜ ××™×©×™, ×œ× ×¢×•×‘×“×” ×©× ×™×ª×Ÿ ×œ×××ª."}} },
                { type: 'exercise', subType: 'ab-test', question: {en:"Which statement is more likely to create connection?", he: "××™×–×• ×××™×¨×” ×¦×¤×•×™×” ×™×•×ª×¨ ×œ×™×¦×•×¨ ×—×™×‘×•×¨?"}, options: [{text: {en:"You're wrong.", he: "××ª×” ×˜×•×¢×”."}, correct: false}, {text: {en:"I see it differently.", he: "×× ×™ ×¨×•××” ××ª ×–×” ××—×¨×ª."}, correct: true}], feedback: {correct: {en:"Yes. 'I see it differently' is an observation of your own perspective, while 'You're wrong' is a direct evaluation of the other person.", he: "×›×Ÿ. '×× ×™ ×¨×•××” ××ª ×–×” ××—×¨×ª' ×”×™× ×”×‘×—× ×” ×©×œ ×”×¤×¨×¡×¤×§×˜×™×‘×” ×©×œ×š, ×‘×¢×•×“ ×©'××ª×” ×˜×•×¢×”' ×”×™× ×”×¢×¨×›×” ×™×©×™×¨×” ×©×œ ×”××“× ×”××—×¨."}, incorrect: {en:"'You're wrong' is a classic evaluation that often leads to defensiveness.", he: "'××ª×” ×˜×•×¢×”' ×”×™× ×”×¢×¨×›×” ×§×œ××¡×™×ª ×©×œ×¢×ª×™× ×§×¨×•×‘×•×ª ××•×‘×™×œ×” ×œ×”×ª×’×•× × ×•×ª."}} },
                { type: 'lesson', title: {en: "Observing Without a 'Why'", he: "×œ×”×‘×—×™×Ÿ ×œ×œ× '×œ××”'"}, content: {en: "A pure observation describes the 'what,' not the 'why.' Guessing someone's motivation ('You did that to annoy me') is an evaluation.", he: "×”×‘×—× ×” ×˜×”×•×¨×” ××ª××¨×ª ××ª ×”'××”', ×œ× ××ª ×”'×œ××”'. × ×™×—×•×© ×”×× ×™×¢×™× ×©×œ ××™×©×”×• ('×¢×©×™×ª ××ª ×–×” ×›×“×™ ×œ×¢×¦×‘×Ÿ ××•×ª×™') ×”×•× ×”×¢×¨×›×”."}, example: {en: "Evaluation: 'You left the door open to let the cat out.'\nObservation: 'I see the door is open.'", he: "×”×¢×¨×›×”: '×”×©××¨×ª ××ª ×”×“×œ×ª ×¤×ª×•×—×” ×›×“×™ ×©×”×—×ª×•×œ ×™×™×¦×.'\n×”×‘×—× ×”: '×× ×™ ×¨×•××” ×©×”×“×œ×ª ×¤×ª×•×—×”.'"} },
                { type: 'exercise', subType: 'mcq', question: {en:"'You're just trying to get attention.' This is an:", he: "'××ª×” ×¨×§ ×× ×¡×” ×œ××©×•×š ×ª×©×•××ª ×œ×‘.' ×–×•×”×™:"}, options: [{text: {en:'Observation of intent', he: '×”×‘×—× ×” ×©×œ ×›×•×•× ×”'}, correct: false}, {text: {en:'Evaluation of intent', he: '×”×¢×¨×›×” ×©×œ ×›×•×•× ×”'}, correct: true}], feedback: {correct: {en:"Exactly. We can't observe intent, we can only guess it. Guessing is a form of evaluation.", he: "×‘×“×™×•×§. ×× ×—× ×• ×œ× ×™×›×•×œ×™× ×œ×”×‘×—×™×Ÿ ×‘×›×•×•× ×”, ×× ×—× ×• ×™×›×•×œ×™× ×¨×§ ×œ× ×—×© ××•×ª×”. × ×™×—×•×© ×”×•× ×¡×•×’ ×©×œ ×”×¢×¨×›×”."}, incorrect: {en:"We can't truly observe someone's intent, so stating it as a fact is an evaluation.", he: "×× ×—× ×• ×œ× ×‘×××ª ×™×›×•×œ×™× ×œ×”×‘×—×™×Ÿ ×‘×›×•×•× ×” ×©×œ ××™×©×”×•, ××– ×”×¦×’×ª×” ×›×¢×•×‘×“×” ×”×™× ×”×¢×¨×›×”."}} },
                { type: 'exercise', subType: 'ab-test', question: {en:"Which is a pure observation?", he: "××™×–×• ×××™×¨×” ×”×™× ×”×‘×—× ×” ×˜×”×•×¨×”?"}, options: [{text: {en:"I noticed you raised your voice.", he: "×©××ª×™ ×œ×‘ ×©×”×¨××ª ××ª ×§×•×œ×š."}, correct: true}, {text: {en:"I noticed you were getting angry.", he: "×©××ª×™ ×œ×‘ ×©×”×ª×—×œ×ª ×œ×›×¢×•×¡."}, correct: false}], feedback: {correct: {en:"Perfect. 'Raised your voice' is a verifiable action. 'Getting angry' is an interpretation of an internal state.", he: "××•×©×œ×. '×”×¨××ª ××ª ×§×•×œ×š' ×”×™× ×¤×¢×•×œ×” ×©× ×™×ª×Ÿ ×œ×××ª. '×œ×”×ª×—×™×œ ×œ×›×¢×•×¡' ×”×™× ×¤×¨×©× ×•×ª ×œ××¦×‘ ×¤× ×™××™."}, incorrect: {en:"'Getting angry' is an interpretation of someone else's feeling. The observation is the action you saw or heard.", he: "'×œ×”×ª×—×™×œ ×œ×›×¢×•×¡' ×”×™× ×¤×¨×©× ×•×ª ×œ×¨×’×© ×©×œ ××™×©×”×• ××—×¨. ×”×”×‘×—× ×” ×”×™× ×”×¤×¢×•×œ×” ×©×¨××™×ª ××• ×©××¢×ª."}} },
            ], poemImage: "https://placehold.co/600x400/E0F7FA/006064?text=G1.jpg"},
            // Feelings
            { id: 4, parent: {en: 'Feelings', he: '×¨×’×©×•×ª'}, level: 1, icon: "â¤ï¸", title: {en: 'Basics', he: '×™×¡×•×“×•×ª'}, screens: [
                { type: 'lesson', title: {en: 'Identifying Feelings', he: '×–×™×”×•×™ ×¨×’×©×•×ª'}, content: {en: "The second step is to notice the feelings that arise from our observation. These are emotions within us, not thoughts about others.", he: "×”×¦×¢×“ ×”×©× ×™ ×”×•× ×œ×©×™× ×œ×‘ ×œ×¨×’×©×•×ª ×©×¢×•×œ×™× ××”×”×‘×—× ×” ×©×œ× ×•. ××œ×• ×”×Ÿ ×¨×’×©×•×ª ×‘×ª×•×›× ×•, ×œ× ××—×©×‘×•×ª ×¢×œ ××—×¨×™×."}, example: {en: "Thought disguised as feeling: 'I feel like you don't care.'\nPure feeling: 'I feel sad.'", he: "××—×©×‘×” ××—×•×¤×©×ª ×œ×¨×’×©: '×× ×™ ××¨×’×™×©/×” ×©×œ× ××›×¤×ª ×œ×š.'\n×¨×’×© ×˜×”×•×¨: '×× ×™ ×¢×¦×•×‘/×”.'"} },
                { type: 'exercise', subType: 'mcq', question: {en: "Which of these is a pure feeling?", he: "××™×–×” ××”×‘××™× ×”×•× ×¨×’×© ×˜×”×•×¨?"}, options: [{text: {en: 'I feel misunderstood.', he: '×× ×™ ××¨×’×™×©/×” ×œ× ××•×‘×Ÿ/×ª.'}, correct: false}, {text: {en: 'I feel pain.', he: '×× ×™ ×—×©/×” ×›××‘.'}, correct: true}, {text: {en: 'I feel that you should know better.', he: '×× ×™ ××¨×’×™×©/×” ×©×”×™×™×ª ×¦×¨×™×š/×” ×œ×“×¢×ª ×™×•×ª×¨ ×˜×•×‘.'}, correct: false}], feedback: {correct: {en: "Yes, 'pain' is a direct feeling. 'Misunderstood' describes a thought about what someone else is thinking.", he: "×›×Ÿ, '×›××‘' ×”×•× ×¨×’×© ×™×©×™×¨. '×œ× ××•×‘×Ÿ' ××ª××¨ ××—×©×‘×” ×¢×œ ××” ×©××—×¨×™× ×—×•×©×‘×™×."}, incorrect: {en: "'Pain' is a pure feeling. 'Misunderstood' is a thought about how someone else sees you.", he: "'×›××‘' ×”×•× ×¨×’×© ×˜×”×•×¨. '×œ× ××•×‘×Ÿ' ×”×™× ××—×©×‘×” ×¢×œ ××™×š ××™×©×”×• ××—×¨ ×¨×•××” ××•×ª×š."}} },
                { type: 'exercise', subType: 'mcq', question: {en: "Which is a feeling?", he: "××™×–×” ××”×‘××™× ×”×•× ×¨×’×©?"}, options: [{text: {en: 'Happy', he: '×©××—'}, correct: true}, {text: {en: 'Abandoned', he: '× ×˜×•×©'}, correct: false}, {text: {en: 'Good', he: '×˜×•×‘'}, correct: false}], feedback: {correct: {en: "Yes, 'happy' is a core feeling.", he: "×›×Ÿ, '×©××—' ×”×•× ×¨×’×© ×œ×™×‘×”."}, incorrect: {en: "'Abandoned' is an interpretation of an action. 'Good' is an evaluation.", he: "'× ×˜×•×©' ×”×•× ×¤×¨×©× ×•×ª ×©×œ ×¤×¢×•×œ×”. '×˜×•×‘' ×”×•× ×”×¢×¨×›×”."}} },
                { type: 'exercise', subType: 'ab-test', question: {en: "Which statement expresses a pure feeling?", he: "××™×–×• ×××™×¨×” ××‘×˜××ª ×¨×’×© ×˜×”×•×¨?"}, options: [{text: {en: 'I feel manipulated.', he: '×× ×™ ××¨×’×™×©/×” ×× ×•×¦×œ/×ª.'}, correct: false}, {text: {en: 'I am disappointed.', he: '×× ×™ ×××•×›×–×‘/×ª.'}, correct: true}], feedback: {correct: {en: "Correct. 'Disappointed' describes your internal experience. 'Manipulated' describes your interpretation of another's actions.", he: "× ×›×•×Ÿ. '×××•×›×–×‘/×ª' ××ª××¨ ××ª ×”×—×•×•×™×” ×”×¤× ×™××™×ª ×©×œ×š. '×× ×•×¦×œ/×ª' ××ª××¨ ××ª ×”×¤×¨×©× ×•×ª ×©×œ×š ×œ×¤×¢×•×œ×•×ª ×©×œ ××—×¨."}, incorrect: {en: "'Manipulated' is an interpretation of someone's actions. 'Disappointed' is a pure feeling.", he: "'×× ×•×¦×œ/×ª' ×”×•× ×¤×¨×©× ×•×ª ×œ×¤×¢×•×œ×•×ª ×©×œ ××™×©×”×• ××—×¨. '×××•×›×–×‘/×ª' ×”×•× ×¨×’×© ×˜×”×•×¨."}} },
                { type: 'exercise', subType: 'ab-test', question: {en: "Which feeling arises when our needs ARE MET?", he: "××™×–×” ×¨×’×© ×¢×•×œ×” ×›××©×¨ ×”×¦×¨×›×™× ×©×œ× ×• ××ª××œ××™×?"}, options: [{text: {en: 'Peaceful', he: '×©×œ×•×•×”'}, correct: true}, {text: {en: 'Anxious', he: '×—×¨×“×”'}, correct: false}], feedback: {correct: {en: "Yes, feelings like 'peaceful', 'happy', and 'joyful' tell us our needs are being met.", he: "×›×Ÿ, ×¨×’×©×•×ª ×›××• '×©×œ×•×•×”', '×©××—×”' ×•'××•×©×¨' ××•××¨×™× ×œ× ×• ×©×”×¦×¨×›×™× ×©×œ× ×• ××ª××œ××™×."}, incorrect: {en: "'Anxious' points to an unmet need, perhaps for safety or clarity. 'Peaceful' signals met needs.", he: "'×—×¨×“×”' ××¦×‘×™×¢×” ×¢×œ ×¦×•×¨×š ×©×œ× ×”×ª××œ×, ××•×œ×™ ×œ×‘×™×˜×—×•×Ÿ ××• ×‘×”×™×¨×•×ª. '×©×œ×•×•×”' ××¡×× ×ª ×¦×¨×›×™× ×©××•×œ××•."}} },
                { type: 'exercise', subType: 'mcq', question: {en: "Which of these is a feeling, not a thought?", he: "××™×–×” ××”×‘××™× ×”×•× ×¨×’×©, ×•×œ× ××—×©×‘×”?"}, options: [{text: {en: 'I feel like leaving.', he: '×‘× ×œ×™ ×œ×œ×›×ª.'}, correct: false}, {text: {en: 'I feel tired.', he: '×× ×™ ×¢×™×™×£/×”.'}, correct: true}, {text: {en: 'I feel you are right.', he: '×× ×™ ××¨×’×™×©/×” ×©××ª/×” ×¦×•×“×§/×ª.'}, correct: false}], feedback: {correct: {en: "Correct. 'Tired' describes a physical and emotional state.", he: "× ×›×•×Ÿ. '×¢×™×™×£/×”' ××ª××¨/×ª ××¦×‘ ×¤×™×–×™ ×•×¨×’×©×™."}, incorrect: {en: "'Feeling like...' or 'feeling that...' usually introduce thoughts, not feelings.", he: "'×‘× ×œ×™...' ××• '×× ×™ ××¨×’×™×©/×” ×©...' ×‘×“×¨×š ×›×œ×œ ××¦×™×’×™× ××—×©×‘×•×ª, ×œ× ×¨×’×©×•×ª."}} },
            ]},
            { id: 5, parent: {en: 'Feelings', he: '×¨×’×©×•×ª'}, level: 2, icon: "â¤ï¸", title: {en: 'Basics+', he: '×™×¡×•×“×•×ª+'}, screens: [
                { type: 'lesson', title: {en: 'Feelings vs. Faux Feelings', he: "×¨×’×©×•×ª ××•×œ '×¨×’×©×•×ª ×“××”'"}, content: {en: "Words like 'attacked,' 'abandoned,' or 'betrayed' often imply that someone else did something *to* us. They are thoughts about others' actions, not pure feelings.", he: "××™×œ×™× ×›××• '××•×ª×§×£', '× ×˜×•×©' ××• '× ×‘×’×“' ×œ×¨×•×‘ ××¨××–×•×ª ×©××™×©×”×• ××—×¨ ×¢×©×” ×œ× ×• ××©×”×•. ×”×Ÿ ××—×©×‘×•×ª ×¢×œ ×¤×¢×•×œ×•×ª ×©×œ ××—×¨×™×, ×œ× ×¨×’×©×•×ª ×˜×”×•×¨×™×."}, example: {en: "Faux feeling: 'I feel rejected.'\nPure feeling behind it: 'I feel lonely,' or 'I feel scared.'", he: "×¨×’×© ×“××”: '×× ×™ ××¨×’×™×©/×” ×“×—×•×™/×”.'\n×”×¨×’×© ×”×˜×”×•×¨ ×××—×•×¨×™×•: '×× ×™ ×‘×•×“×“/×”,' ××• '×× ×™ ×¤×•×—×“/×ª.'"} },
                { type: 'exercise', subType: 'mcq', question: {en: "Which of these is a 'faux feeling' (a thought about an action)?", he: "××™×–×” ××”×‘××™× ×”×•× '×¨×’×© ×“××”' (××—×©×‘×” ×¢×œ ×¤×¢×•×œ×”)?"}, options: [{text: {en: 'Sad', he: '×¢×¦×‘'}, correct: false}, {text: {en: 'Ignored', he: '×”×ª×¢×œ××•×ª'}, correct: true}, {text: {en: 'Joyful', he: '×©××—×”'}, correct: false}], feedback: {correct: {en: "Correct. 'Ignored' implies someone did something to you. The feeling behind it might be 'loneliness' or 'sadness'.", he: "× ×›×•×Ÿ. '×”×ª×¢×œ××•×ª' ××¨××–×ª ×©××™×©×”×• ×¢×©×” ×œ×š ××©×”×•. ×”×¨×’×© ×××—×•×¨×™ ×–×” ×¢×©×•×™ ×œ×”×™×•×ª '×‘×“×™×“×•×ª' ××• '×¢×¦×‘'."}, incorrect: {en: "'Sad' and 'joyful' are pure feelings. 'Ignored' is an interpretation of someone else's action.", he: "'×¢×¦×‘' ×•'×©××—×”' ×”× ×¨×’×©×•×ª ×˜×”×•×¨×™×. '×”×ª×¢×œ××•×ª' ×”×™× ×¤×¨×©× ×•×ª ×œ×¤×¢×•×œ×” ×©×œ ××™×©×”×• ××—×¨."}} },
                { type: 'exercise', subType: 'matching', question: {en: "Match the 'faux feeling' to a possible pure feeling.", he: "×”×ª×× ××ª '×¨×’×© ×”×“××”' ×œ×¨×’×© ×˜×”×•×¨ ××¤×©×¨×™."}, pairs: [{item1: {en: 'I feel judged', he: '×× ×™ ××¨×’×™×©/×” ×©×™×¤×•×˜×™/×ª'}, item2: {en: 'I feel anxious', he: '×× ×™ ×—×©/×” ×—×¨×“×”'}}, {item1: {en: 'I feel unheard', he: '×× ×™ ××¨×’×™×©/×” ×©×œ× ×©×•××¢×™× ××•×ª×™'}, item2: {en: 'I feel frustrated', he: '×× ×™ ××ª×•×¡×›×œ/×ª'}}, {item1: {en: 'I feel attacked', he: '×× ×™ ××¨×’×™×©/×” ××•×ª×§×£/×ª'}, item2: {en: 'I feel scared', he: '×× ×™ ×¤×•×—×“/×ª'}}], feedback: {correct: {en: "Excellent! You're seeing past the thought to the real feeling underneath.", he: "××¦×•×™×Ÿ! ××ª× ×¨×•××™× ××¢×‘×¨ ×œ××—×©×‘×” ××œ ×”×¨×’×© ×”×××™×ª×™ ×©××ª×—×ª×™×”."}, incorrect: {en: "Try again. What might you be feeling inside when you think someone is judging you?", he: "× ×¡×• ×©×•×‘. ××” ××ª× ×¢×©×•×™×™× ×œ×”×¨×’×™×© ×‘×¤× ×™× ×›×©××ª× ×—×•×©×‘×™× ×©××™×©×”×• ×©×•×¤×˜ ××ª×›×?"}} },
                { type: 'lesson', title: {en: 'Taking Responsibility', he: '×œ×§×™×—×ª ××—×¨×™×•×ª'}, content: {en: "Instead of saying 'You make me angry,' NVC encourages 'I feel angry when...'. This takes responsibility for our own feelings, which are generated by our needs, not by others' actions.", he: "×‘××§×•× ×œ×•××¨ '××ª/×” ××›×¢×™×¡/×” ××•×ª×™', ×ª×§×©×•×¨×ª ××§×¨×‘×ª ××¢×•×“×“×ª '×× ×™ ×›×•×¢×¡/×ª ×›×©...'. ×–×” ×œ×•×§×— ××—×¨×™×•×ª ×¢×œ ×”×¨×’×©×•×ª ×©×œ× ×•, ×©× ×•×¦×¨×™× ××”×¦×¨×›×™× ×©×œ× ×•, ×œ× ××¤×¢×•×œ×•×ª ×©×œ ××—×¨×™×."} },
                { type: 'exercise', subType: 'ab-test', question: {en: "Which statement takes responsibility for the feeling?", he: "××™×–×• ×××™×¨×” ×œ×•×§×—×ª ××—×¨×™×•×ª ×¢×œ ×”×¨×’×©?"}, options: [{text: {en: "You're annoying me.", he: "××ª/×” ××¢×¦×‘×Ÿ/×ª ××•×ª×™."}, correct: false}, {text: {en: "I feel annoyed when I hear that.", he: "×× ×™ ××¨×’×™×©/×” ×¢×¦×‘× ×•×ª ×›×©×× ×™ ×©×•××¢/×ª ××ª ×–×”."}, correct: true}], feedback: {correct: {en: "Yes. This phrasing owns the feeling ('I feel annoyed') instead of blaming the other person.", he: "×›×Ÿ. × ×™×¡×•×— ×–×” ×œ×•×§×— ×‘×¢×œ×•×ª ×¢×œ ×”×¨×’×© ('×× ×™ ××¨×’×™×©/×” ×¢×¦×‘× ×•×ª') ×‘××§×•× ×œ×”××©×™× ××ª ×”××“× ×”××—×¨."}, incorrect: {en: "'You're annoying me' places the cause of the feeling on the other person.", he: "'××ª/×” ××¢×¦×‘×Ÿ/×ª ××•×ª×™' ×× ×™×— ××ª ×”×¡×™×‘×” ×œ×¨×’×© ××¦×œ ×”××“× ×”××—×¨."}} },
                { type: 'exercise', subType: 'mcq', question: {en: "According to NVC, what is the true source of our feelings?", he: "×œ×¤×™ ×ª×§×©×•×¨×ª ××§×¨×‘×ª, ××”×• ×”××§×•×¨ ×”×××™×ª×™ ×©×œ ×”×¨×’×©×•×ª ×©×œ× ×•?"}, options: [{text: {en: "Other people's actions", he: "×¤×¢×•×œ×•×ª ×©×œ ×× ×©×™× ××—×¨×™×"}, correct: false}, {text: {en: "Our met or unmet needs", he: "×”×¦×¨×›×™× ×©×œ× ×• ×©××•×œ××• ××• ×œ× ××•×œ××•"}, correct: true}, {text: {en: "The situation we are in", he: "×”××¦×‘ ×‘×• ×× ×• × ××¦××™×"}, correct: false}], feedback: {correct: {en: "Exactly. Our feelings are signals about our needs.", he: "×‘×“×™×•×§. ×”×¨×’×©×•×ª ×©×œ× ×• ×”× ××™×ª×•×ª×™× ×œ×’×‘×™ ×”×¦×¨×›×™× ×©×œ× ×•."}, incorrect: {en: "While actions and situations are triggers, NVC teaches that the root cause of feelings lies in our needs.", he: "×‘×¢×•×“ ×©×¤×¢×•×œ×•×ª ×•××¦×‘×™× ×”× ×˜×¨×™×’×¨×™×, ×ª×§×©×•×¨×ª ××§×¨×‘×ª ××œ××“×ª ×©×©×•×¨×© ×”×¨×’×©×•×ª ×˜××•×Ÿ ×‘×¦×¨×›×™× ×©×œ× ×•."}} },
            ]},
            { id: 6, parent: {en: 'Feelings', he: '×¨×’×©×•×ª'}, level: 3, icon: "â¤ï¸", title: {en: 'Advanced', he: '××ª×§×“×'}, screens: [
                { type: 'lesson', title: {en: 'Expanding Your Feelings Vocabulary', he: '×”×¨×—×‘×ª ××•×¦×¨ ×”××™×œ×™× ×©×œ ×”×¨×’×©×•×ª'}, content: {en: "The more words we have for our feelings, the better we can understand ourselves. Are you 'angry,' or are you 'frustrated,' 'irritated,' or 'impatient'?", he: "×›×›×œ ×©×™×© ×œ× ×• ×™×•×ª×¨ ××™×œ×™× ×œ×¨×’×©×•×ª ×©×œ× ×•, ×›×š × ×•×›×œ ×œ×”×‘×™×Ÿ ××ª ×¢×¦×× ×• ×˜×•×‘ ×™×•×ª×¨. ×”×× ××ª/×” '×›×•×¢×¡/×ª', ××• ×©××•×œ×™ '××ª×•×¡×›×œ/×ª', '×¢×¦×‘× ×™/×ª' ××• '×—×¡×¨/×ª ×¡×‘×œ× ×•×ª'?"} },
                { type: 'exercise', subType: 'matching', question: {en: "Match the situation to a possible feeling.", he: "×”×ª×× ××ª ×”×¡×™×˜×•××¦×™×” ×œ×¨×’×© ××¤×©×¨×™."}, pairs: [{item1: {en: 'Seeing a friend after a long time', he: '×œ×¨××•×ª ×—×‘×¨ ××—×¨×™ ×”×¨×‘×” ×–××Ÿ'}, item2: {en: 'Joyful', he: '×©××—×”'}}, {item1: {en: 'Missing a flight', he: '×œ×¤×¡×¤×¡ ×˜×™×¡×”'}, item2: {en: 'Frustration', he: '×ª×¡×›×•×œ'}}, {item1: {en: 'Receiving a surprise gift', he: '×œ×§×‘×œ ××ª× ×ª ×”×¤×ª×¢×”'}, item2: {en: 'Surprise', he: '×”×¤×ª×¢×”'}}], feedback: {correct: {en: "Great matches! Connecting situations to feelings is a key step.", he: "×”×ª×××•×ª × ×”×“×¨×•×ª! ×—×™×‘×•×¨ ×‘×™×Ÿ ××¦×‘×™× ×œ×¨×’×©×•×ª ×”×•× ×¦×¢×“ ××¤×ª×—."}, incorrect: {en: "Let's try that again. Think about what emotion might come up in each situation.", he: "×‘×•× × × ×¡×” ×©×•×‘. ×—×©×‘×• ××™×–×• ×ª×—×•×©×” ×™×›×•×œ×” ×œ×¢×œ×•×ª ×‘×›×œ ××¦×‘."}} },
                { type: 'exercise', subType: 'mcq', question: {en: "When you hear 'I feel like you're not listening,' what might be the underlying feeling?", he: "×›×©××ª/×” ×©×•××¢/×ª '×× ×™ ××¨×’×™×©/×” ×©××ª/×” ×œ× ××§×©×™×‘/×”', ××” ×¢×©×•×™ ×œ×”×™×•×ª ×”×¨×’×© ×©××ª×—×ª?"}, options: [{text: {en: 'Loneliness', he: '×‘×“×™×“×•×ª'}, correct: true}, {text: {en: 'Blame', he: '×”××©××”'}, correct: false}, {text: {en: 'Logic', he: '×”×™×’×™×•×Ÿ'}, correct: false}], feedback: {correct: {en: "Exactly. The feeling of not being heard often points to a deeper feeling of loneliness or a need for connection.", he: "×‘×“×™×•×§. ×”×ª×—×•×©×” ×©×œ× ××§×©×™×‘×™× ×œ×š ××¦×‘×™×¢×” ×œ×¢×ª×™× ×§×¨×•×‘×•×ª ×¢×œ ×ª×—×•×©×” ×¢××•×§×” ×™×•×ª×¨ ×©×œ ×‘×“×™×“×•×ª ××• ×¢×œ ×¦×•×¨×š ×‘×—×™×‘×•×¨."}, incorrect: {en: "Blame and logic are thoughts, not feelings. The core feeling might be loneliness or sadness.", he: "×”××©××” ×•×”×™×’×™×•×Ÿ ×”× ××—×©×‘×•×ª, ×œ× ×¨×’×©×•×ª. ×”×¨×’×© ×”××¨×›×–×™ ×¢×©×•×™ ×œ×”×™×•×ª ×‘×“×™×“×•×ª ××• ×¢×¦×‘."}} },
                { type: 'lesson', title: {en: 'Physical Sensations', he: '×ª×—×•×©×•×ª ×’×•×¤× ×™×•×ª'}, content: {en: "Sometimes the easiest way to identify a feeling is to notice the physical sensation in your body. A tight chest, a warm glow, a knot in your stomach...", he: "×œ×¤×¢××™× ×”×“×¨×š ×”×§×œ×” ×‘×™×•×ª×¨ ×œ×–×”×•×ª ×¨×’×© ×”×™× ×œ×©×™× ×œ×‘ ×œ×ª×—×•×©×” ×”×¤×™×–×™×ª ×‘×’×•×£. ×—×–×” ××›×•×•×¥, ×–×•×”×¨ ×—×, ×§×©×¨ ×‘×‘×˜×Ÿ..."}, example: {en: "'When I think about the presentation, my stomach feels tight. I am nervous.'", he: "'×›×©×× ×™ ×—×•×©×‘/×ª ×¢×œ ×”××¦×’×ª, ×”×‘×˜×Ÿ ×©×œ×™ ××ª×›×•×•×¦×ª. ×× ×™ ×œ×—×•×¥/×”.'"} },
                { type: 'exercise', subType: 'matching', question: {en: "Match the physical sensation to a likely feeling.", he: "×”×ª×× ××ª ×”×ª×—×•×©×” ×”×¤×™×–×™×ª ×œ×¨×’×© ×¡×‘×™×¨."}, pairs: [{item1: {en: 'Butterflies in stomach', he: '×¤×¨×¤×¨×™× ×‘×‘×˜×Ÿ'}, item2: {en: 'Excitement', he: '×”×ª×¨×’×©×•×ª'}}, {item1: {en: 'Heavy shoulders', he: '×›×ª×¤×™×™× ×›×‘×“×•×ª'}, item2: {en: 'Burdened', he: '×¢×•××¡'}}, {item1: {en: 'Warm chest', he: '×—×–×” ×—×'}, item2: {en: 'Affection', he: '×—×™×‘×”'}}], feedback: {correct: {en: "Great! Your body is a wonderful source of information about your feelings.", he: "× ×”×“×¨! ×”×’×•×£ ×©×œ×š ×”×•× ××§×•×¨ ××™×“×¢ × ×¤×œ× ×¢×œ ×”×¨×’×©×•×ª ×©×œ×š."}, incorrect: {en: "Think about what emotion you associate with that physical feeling.", he: "×—×©×‘×• ×¢×œ ×”×¨×’×© ×©××ª× ××§×©×¨×™× ×œ×ª×—×•×©×” ×”×¤×™×–×™×ª ×”×–×•."}} },
                { type: 'exercise', subType: 'ab-test', question: {en: "Which statement connects a physical sensation to a feeling?", he: "××™×–×• ×××™×¨×” ××—×‘×¨×ª ×ª×—×•×©×” ×¤×™×–×™×ª ×œ×¨×’×©?"}, options: [{text: {en: 'My hands are shaking.', he: '×”×™×“×™×™× ×©×œ×™ ×¨×•×¢×“×•×ª.'}, correct: false}, {text: {en: 'My hands are shaking, and I am feeling scared.', he: '×”×™×“×™×™× ×©×œ×™ ×¨×•×¢×“×•×ª, ×•×× ×™ ×—×©/×” ×¤×—×“.'}, correct: true}], feedback: {correct: {en: "Yes, this connects the physical data to the emotional data.", he: "×›×Ÿ, ×–×” ××—×‘×¨ ××ª ×”× ×ª×•× ×™× ×”×¤×™×–×™×™× ×œ× ×ª×•× ×™× ×”×¨×’×©×™×™×."}, incorrect: {en: "Just stating the sensation is an observation. Connecting it to a feeling word gives it meaning.", he: "×¨×§ ×œ×¦×™×™×Ÿ ××ª ×”×ª×—×•×©×” ×–×• ×”×‘×—× ×”. ×—×™×‘×•×¨×” ×œ××™×œ×ª ×¨×’×© × ×•×ª×Ÿ ×œ×” ××©××¢×•×ª."}} },
            ], poemImage: "https://placehold.co/600x400/FFEBEE/B71C1C?text=G2.png"},
            // ... (Rest of the modules will be updated similarly)
        ];

        function saveData() { localStorage.setItem('nvcCourseProgress', JSON.stringify(state)); }
        function loadData() {
            const savedData = localStorage.getItem('nvcCourseProgress');
            if (savedData) {
                const parsed = JSON.parse(savedData);
                state = { ...defaultState, ...parsed };
            } else {
                state = { ...defaultState };
            }
        }
        function createButton(text, onClick, extraClass = '') { const btn = document.createElement('button'); btn.innerHTML = text; btn.className = `btn ${extraClass}`; btn.onclick = onClick; return btn; }
        
        function getTranslation(obj) {
            if (typeof obj !== 'object' || obj === null) {
                return obj;
            }
            return obj[state.lang] || obj['en'];
        }

        function updateUI() { 
            const t = getTranslation(courseContent);
            const totalPlayableModules = modules.filter(m => !m.comingSoon).length;
            let progressPercentage = totalPlayableModules > 0 ? (state.completedModules.length / totalPlayableModules) * 100 : 0;
            
            livesDisplay.style.display = 'none';
            
            if (state.view === 'stage') {
                const module = modules.find(s => s.id === state.activeModule.id);
                const exercisesInModule = module.screens.filter(s => s.type === 'exercise').length;
                const completedExercises = state.activeModule.completedExercises.length;
                progressPercentage = exercisesInModule > 0 ? (completedExercises / exercisesInModule) * 100 : 0;
                
                livesDisplay.innerHTML = `â¤ï¸`.repeat(state.activeModule.lives);
                livesDisplay.style.display = 'block';
            }
            
            progressBar.style.width = `${progressPercentage}%`;
            xpDisplay.innerHTML = `ğŸ’– ${state.xp}`; 
            soundToggle.textContent = state.isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
            themeToggle.textContent = document.body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ğŸŒ™';
            document.body.dir = state.lang === 'he' ? 'rtl' : 'ltr';
            
            const giraffeIndex = Math.min(state.completedModules.length, giraffeSVGs.length - 1);
            giraffeSvgContainer.innerHTML = giraffeSVGs[giraffeIndex];
            renderMiniMap();
        }

        function render() {
            updateUI();
            contentArea.innerHTML = '';
            const view = state.view;
            if (view === 'map') renderMapView();
            else if (view === 'stage') renderModuleView();
            else if (view === 'moduleComplete') renderModuleCompleteScreen();
            else if (view === 'moduleFailed') renderModuleFailedScreen();
            else if (view === 'final') renderFinalScreen();
            else if (view === 'poem') renderPoemScreen();
        }
        
        function renderPoemScreen() {
            const t = getTranslation(courseContent);
            const module = modules.find(m => m.id === state.activeModule.id);
            contentArea.innerHTML = `
                <div class="poem-container">
                    <img src="${module.poemImage}" alt="NVC Poem" class="poem-image">
                    <button id="poem-continue-btn" class="btn btn-primary">${t.continueToMap}</button>
                </div>
            `;
            document.getElementById('poem-continue-btn').onclick = () => {
                state.view = 'map';
                render();
            };
        }

        function renderMiniMap() {
            const container = document.getElementById('mini-map-container');
            if (!container) return;
            container.innerHTML = '';
            const uniqueParentNames = [...new Set(modules.map(m => m.parent.en))];
            const allParents = uniqueParentNames.map(name => modules.find(m => m.parent.en === name).parent);

            allParents.forEach(parent => {
                const group = document.createElement('div');
                group.className = 'mini-map-group';
                const parentModules = modules.filter(m => m.parent.en === parent.en);
                parentModules.forEach(module => {
                    const dot = document.createElement('div');
                    dot.className = 'mini-map-dot';
                    dot.title = getTranslation(module.title);
                    if(module.comingSoon) {
                        dot.classList.add('coming-soon');
                    } else if (state.completedModules.includes(module.id)) {
                        dot.classList.add('completed');
                    } else if (state.completedModules.length + 1 === module.id) {
                        dot.classList.add('unlocked');
                    } else {
                        dot.classList.add('locked');
                    }
                    group.appendChild(dot);
                });
                container.appendChild(group);
            });
        }

        function renderMapView() {
            const t = getTranslation(courseContent);

            const uniqueParentNames = [...new Set(modules.map(m => m.parent.en))];
            const allParents = uniqueParentNames.map(name => modules.find(m => m.parent.en === name).parent);

            let currentParent = allParents[0];
            const nextModuleId = state.completedModules.length + 1;
            const nextModule = modules.find(m => m.id === nextModuleId);
            if (nextModule) {
                currentParent = nextModule.parent;
            } else {
                const lastCompletedModule = modules.find(m => m.id === state.completedModules.length);
                if(lastCompletedModule) {
                    currentParent = lastCompletedModule.parent;
                }
            }
            
            const renderSection = (title, sectionModules) => {
                const mapView = document.createElement('div');
                mapView.className = 'map-view';
                mapView.innerHTML = `<h2 class="level-title">${title}</h2>`;
                sectionModules.forEach(moduleData => {
                    const node = document.createElement('div');
                    node.className = 'stage-node';
                    const isCompleted = state.completedModules.includes(moduleData.id);
                    const isUnlocked = !moduleData.comingSoon && state.completedModules.length + 1 === moduleData.id;
                    const isLocked = !isCompleted && !isUnlocked;
                    
                    const button = document.createElement('button');
                    button.className = 'stage-button';
                    
                    if (moduleData.comingSoon) {
                        button.classList.add('coming-soon');
                    } else if(isCompleted) {
                        button.classList.add('completed');
                    } else if(isUnlocked) {
                        button.classList.add('unlocked');
                    } else {
                        button.classList.add('locked');
                    }
                    
                    button.disabled = isLocked || moduleData.comingSoon;
                    let levelIndicator = '';
                    if (moduleData.level === 2) {
                        levelIndicator = 'ğŸ’ª';
                    } else if (moduleData.level === 3) {
                        levelIndicator = 'ğŸ’ªğŸ’ª';
                    }
                    button.innerHTML = `<div class="stage-icon-container"><div class="stage-icon">${moduleData.icon}</div><div class="level-indicator">${levelIndicator}</div></div><div class="stage-title-map">${getTranslation(moduleData.title)}</div>`;
                    
                    if (!moduleData.comingSoon) {
                        button.onclick = () => { 
                            gtag('event', 'module_start', { 'module_id': moduleData.id });
                            state.view = 'stage'; 
                            state.activeModule = { id: moduleData.id, screen: 0, lives: 3, completedExercises: [] }; 
                            render(); 
                        };
                    }

                    if (isUnlocked) {
                        const botIcon = document.createElement('div');
                        botIcon.className = 'giraffe-map-icon';
                        const giraffeIndex = Math.min(state.completedModules.length, giraffeSVGs.length - 1);
                        botIcon.innerHTML = giraffeSVGs[giraffeIndex];
                        node.appendChild(botIcon);
                    }
                    node.appendChild(button);
                    mapView.appendChild(node);
                });
                contentArea.appendChild(mapView);
            };
            
            const playableModules = modules.filter(m => !m.comingSoon);
            if (state.completedModules.length === playableModules.length) {
                state.view = 'final';
                render();
                return;
            }

            renderSection(getTranslation(currentParent), modules.filter(m => m.parent.en === currentParent.en));
            
            const mainModules = modules.filter(m => m.parent.en !== 'Empathy');
            if (state.completedModules.length >= mainModules.length) {
                 renderSection(t.empathyTitle, modules.filter(m => m.parent.en === 'Empathy'));
            }

            giraffeSpeech.textContent = t.mapSpeech;
        }

        function renderModuleView() {
            const t = getTranslation(courseContent);
            const module = modules.find(s => s.id === state.activeModule.id);
            if (!module) return;
            const screenData = module.screens[state.activeModule.screen];

            const header = document.createElement('div');
            header.className = 'screen-header';
            
            const backButton = document.createElement('button');
            backButton.className = 'back-to-menu-btn';
            backButton.innerHTML = '&#x2190;'; // Left arrow
            if (state.lang === 'he') {
                backButton.innerHTML = '&#x2192;'; // Right arrow for RTL
            }
            backButton.title = t.backToMenu;
            backButton.onclick = () => {
                state.view = 'map';
                render();
            };
            
            const title = document.createElement('h1');
            title.className = 'screen-title';
            
            const placeholder = document.createElement('div');
            placeholder.style.width = '2rem'; // Same as back button approx
            
            header.appendChild(backButton);
            header.appendChild(title);
            header.appendChild(placeholder);
            
            contentArea.appendChild(header);
            
            giraffeSpeech.textContent = t.stageSpeech;

            if (screenData.type === 'lesson') {
                title.textContent = getTranslation(screenData.title);
                const content = document.createElement('p'); 
                content.className = 'lesson-content'; 
                content.innerHTML = getTranslation(screenData.content); 
                contentArea.appendChild(content);
                
                if (screenData.example) { 
                    const example = document.createElement('div'); 
                    example.className = 'lesson-example'; 
                    example.innerHTML = getTranslation(screenData.example).replace(/\n/g, '<br>'); 
                    contentArea.appendChild(example); 
                }
                
                const nextButton = createButton(t.continue, () => advanceScreen(), 'btn-primary');
                contentArea.appendChild(nextButton);
            } else if (screenData.type === 'exercise') {
                title.textContent = `${getTranslation(module.parent)} - ${getTranslation(module.title)}`;
                renderExerciseScreen(screenData);
            }
        }
        
        function advanceScreen() {
            const module = modules.find(s => s.id === state.activeModule.id);
            if (state.activeModule.screen < module.screens.length - 1) {
                state.activeModule.screen++; render();
            } else {
                state.view = 'moduleComplete';
                render();
            }
        }
        
        function completeModule() {
            const currentModule = modules.find(m => m.id === state.activeModule.id);
            if (!state.completedModules.includes(state.activeModule.id)) {
                gtag('event', 'module_complete', { 'module_id': state.activeModule.id });
                state.completedModules.push(state.activeModule.id);
                state.xp += 25;
            }

            // Check if this is the last module of a parent category and has a poem
            const parentModules = modules.filter(m => m.parent.en === currentModule.parent.en);
            const lastModuleOfParent = parentModules[parentModules.length - 1];
            if (currentModule.id === lastModuleOfParent.id && currentModule.poemImage) {
                state.view = 'poem';
                saveData();
                render();
                return;
            }

            const playableModules = modules.filter(m => !m.comingSoon);
            if (state.completedModules.length >= playableModules.length) {
                gtag('event', 'level_complete', { 'level_id': 1 });
                state.view = 'final';
            } else {
                state.view = 'map';
            }
            saveData();
            render();
        }

        function handleAnswer(button, isCorrect, feedbackData) {
            const t = getTranslation(courseContent);
            contentArea.querySelectorAll('button:not(.btn-primary)').forEach(b => b.disabled = true);
            const feedbackSection = document.createElement('div');
            const nextButtonContainer = document.createElement('div');
            feedbackSection.id = 'feedback-section';
            feedbackSection.innerHTML = `<div class="feedback-message"></div>`;
            nextButtonContainer.id = 'next-button-container';
            feedbackSection.appendChild(nextButtonContainer);
            const feedbackMessage = feedbackSection.querySelector('.feedback-message');
            
            const feedback = {
                correct: getTranslation(feedbackData.correct),
                incorrect: getTranslation(feedbackData.incorrect)
            };

            if (isCorrect) {
                playSound('correct');
                state.xp += 10;
                state.streak++;
                // Only add to completed exercises if it's not already there
                if (!state.activeModule.completedExercises.includes(state.activeModule.screen)) {
                    state.activeModule.completedExercises.push(state.activeModule.screen);
                }

                button.classList.add('correct');
                feedbackMessage.textContent = feedback.correct;
                feedbackMessage.className = 'feedback-message correct';
                if (state.streak >= 3) { giraffeSpeech.textContent = getTranslation({en: "You're connecting so well! âœ¨", he: "××ª× ××ª×—×‘×¨×™× ×›×œ ×›×š ×˜×•×‘! âœ¨"}); playSound('streak'); }
                else { giraffeSpeech.textContent = t.gotIt; }
                const nextButton = createButton(t.continue, () => advanceScreen(), 'btn-primary');
                nextButtonContainer.appendChild(nextButton);
            } else {
                gtag('event', 'answer_incorrect', { 'module_id': state.activeModule.id, 'screen_id': state.activeModule.screen });
                playSound('incorrect');
                state.streak = 0;
                state.activeModule.lives--;
                button.classList.add('incorrect');
                feedbackMessage.textContent = feedback.incorrect;
                feedbackMessage.className = 'feedback-message incorrect';
                giraffeSpeech.textContent = getTranslation({en: "That's a common mix-up. Let's look again.", he: "×–×” ×‘×œ×‘×•×œ × ×¤×•×¥. ×‘×•××• × × ×¡×” ×©×•×‘."});

                if (state.activeModule.lives <= 0) {
                    state.view = 'moduleFailed';
                    setTimeout(render, 1500);
                } else {
                    const retryButton = createButton(t.tryAgain, () => render());
                    nextButtonContainer.appendChild(retryButton);
                }
            }
            contentArea.appendChild(feedbackSection);
            saveData();
            updateUI();
        }
        
        function renderFinalScreen() {
            const t = getTranslation(courseContent);
            contentArea.innerHTML = '';
            const title = document.createElement('h1');
            title.className = 'completion-title';
            title.textContent = t.finalTitle;
            contentArea.appendChild(title);
            const content = document.createElement('p');
            content.className = 'lesson-content';
            content.innerHTML = `${t.finalContent}<br><br><strong>${t.comingSoon}</strong>`;
            contentArea.appendChild(content);

            const completionActions = document.createElement('div');
            completionActions.className = 'completion-actions';
            
            const feedbackButton = createButton(t.feedbackCTA, () => window.open('https://forms.gle/V5ZWLzknQLtLNEUg8', '_blank'), 'btn-primary');
            completionActions.appendChild(feedbackButton);

            const supportText = document.createElement('p');
            supportText.textContent = t.supportCTA;
            supportText.style.fontSize = '0.9rem';
            supportText.style.marginTop = '1rem';
            completionActions.appendChild(supportText);
            
            const supportButton = createButton(t.supportProject, () => window.open('https://revolut.me/yonatahf89', '_blank'));
            completionActions.appendChild(supportButton);

            const resetButton = document.createElement('button');
            resetButton.id = 'reset-progress-btn';
            resetButton.textContent = t.resetProgress;
            resetButton.onclick = showResetConfirmModal;
            completionActions.appendChild(resetButton);

            contentArea.appendChild(completionActions);
            
            for(let i=0; i<100; i++) { const c = document.createElement('div'); c.className='confetti'; c.style.left=Math.random()*100+'vw'; c.style.animationDuration=Math.random()*2+3+'s'; c.style.backgroundColor=`hsl(${Math.random()*360},100%,50%)`; document.body.appendChild(c); setTimeout(() => { c.remove() }, 5000); }
            giraffeSpeech.textContent = t.finalBot;
        }

        function renderModuleCompleteScreen() {
            playSound('moduleComplete');
            const t = getTranslation(courseContent);
            contentArea.innerHTML = '';
            const icon = document.createElement('div');
            icon.className = 'completion-icon';
            icon.textContent = 'ğŸ‰';
            contentArea.appendChild(icon);
            const title = document.createElement('h2');
            title.className = 'completion-title';
            title.textContent = t.moduleComplete;
            contentArea.appendChild(title);

            const completionActions = document.createElement('div');
            completionActions.className = 'completion-actions';
            
            const continueButton = createButton(t.continueToMap, () => completeModule(), 'btn-primary');
            completionActions.appendChild(continueButton);
            
            const playableModules = modules.filter(m => !m.comingSoon);
            if (state.activeModule.id === playableModules.length) {
                 const feedbackButton = createButton(t.feedbackCTA, () => window.open('https://forms.gle/V5ZWLzknQLtLNEUg8', '_blank'));
                 completionActions.appendChild(feedbackButton);
            }

            const resetButton = document.createElement('button');
            resetButton.id = 'reset-progress-btn';
            resetButton.textContent = t.resetProgress;
            resetButton.onclick = showResetConfirmModal;
            completionActions.appendChild(resetButton);

            contentArea.appendChild(completionActions);
        }

        function renderModuleFailedScreen() {
            const t = getTranslation(courseContent);
            contentArea.innerHTML = '';
            const icon = document.createElement('div');
            icon.className = 'completion-icon';
            icon.textContent = 'ğŸŒ±';
            contentArea.appendChild(icon);
            const title = document.createElement('h2');
            title.className = 'completion-title';
            title.textContent = t.outOfTries;
            contentArea.appendChild(title);
            const content = document.createElement('p');
            content.className = 'lesson-content';
            content.textContent = t.outOfTriesMsg;
            contentArea.appendChild(content);
            const retryButton = createButton(t.tryAgain, () => {
                state.view = 'map'; render();
            }, 'btn-primary');
            contentArea.appendChild(retryButton);
        }

        function renderExerciseScreen(screenData) {
            const questionText = getTranslation(screenData.question);
            const question = document.createElement('p'); question.className = 'exercise-question'; question.textContent = questionText; contentArea.appendChild(question);
            const choiceContainer = document.createElement('div');
            switch(screenData.subType) {
                case 'mcq': case 'ab-test':
                    choiceContainer.className = 'choice-grid';
                    screenData.options.forEach(option => { 
                        const btn = createButton(getTranslation(option.text), () => handleAnswer(btn, option.correct, screenData.feedback));
                        choiceContainer.appendChild(btn);
                     });
                    break;
                case 'matching':
                     choiceContainer.className = 'matching-grid';
                     renderMatchingExercise(screenData, choiceContainer);
                     break;
            }
            contentArea.appendChild(choiceContainer);
        }

        function renderMatchingExercise(data, container) {
            const translatedPairs = data.pairs.map(p => ({
                item1: getTranslation(p.item1),
                item2: getTranslation(p.item2)
            }));
            const allItems = translatedPairs.flatMap(p => [p.item1, p.item2]);
            const shuffledItems = [...allItems].sort(() => Math.random() - 0.5);

            let selectedButton = null;
            let correctPairs = 0;

            const checkMatch = (clickedButton) => {
                if (!selectedButton) {
                    selectedButton = clickedButton;
                    selectedButton.classList.add('selected');
                    return;
                }
                if (selectedButton === clickedButton) { 
                    selectedButton.classList.remove('selected'); 
                    selectedButton = null; 
                    return; 
                }
                
                const val1 = selectedButton.textContent;
                const val2 = clickedButton.textContent;
                const isMatch = translatedPairs.some(p => (p.item1 === val1 && p.item2 === val2) || (p.item1 === val2 && p.item2 === val1));
                
                const btn1 = selectedButton;
                const btn2 = clickedButton;

                if (isMatch) {
                    playSound('correct');
                    [btn1, btn2].forEach(btn => {
                        if (btn) {
                            btn.classList.remove('selected'); 
                            btn.classList.add('correct'); 
                            btn.disabled = true; 
                        }
                    });
                    correctPairs++;
                    if (correctPairs === translatedPairs.length) { 
                        setTimeout(() => handleAnswer(container, true, data.feedback), 300); 
                    }
                } else {
                    playSound('incorrect');
                    [btn1, btn2].forEach(btn => {
                        if(btn) btn.classList.add('incorrect');
                    });
                    setTimeout(() => { 
                        [btn1, btn2].forEach(btn => {
                            if(btn) btn.classList.remove('incorrect', 'selected');
                        }); 
                    }, 800);
                }
                selectedButton = null;
            };

            shuffledItems.forEach(text => {
                const btn = createButton(text, () => checkMatch(btn), 'matching-pair');
                container.appendChild(btn);
            });
        }
        
        function setTheme(theme) {
            state.theme = theme;
            document.body.classList.toggle('dark-mode', theme === 'dark');
            saveData();
            updateUI();
        }
        
        function setLanguage(lang) {
            state.lang = lang;
            const t = getTranslation(courseContent);
            
            welcomeTitle.textContent = t.welcomeTitle;
            welcomeText.textContent = t.welcomeText;
            langSelectLabel.textContent = t.langSelectLabel;
            startCourseBtn.innerHTML = t.letsGo;
            supportLink.textContent = t.supportProject;
            termsLink.textContent = t.terms;
            privacyLink.textContent = t.privacy;
            cookieText.textContent = t.cookieText;
            acceptCookiesBtn.textContent = t.accept;
            declineCookiesBtn.textContent = t.decline;
            closePolicyBtn.textContent = t.close;
            resetConfirmTitle.textContent = t.resetConfirmTitle;
            resetConfirmText.textContent = t.resetConfirmText;
            confirmResetBtn.textContent = t.confirmReset;
            cancelResetBtn.textContent = t.cancel;


            langBtnEn.classList.toggle('active', lang === 'en');
            langBtnHe.classList.toggle('active', lang === 'he');

            document.body.dir = state.lang === 'he' ? 'rtl' : 'ltr';
            saveData();
        }

        function showPolicy(type) {
            const t = getTranslation(courseContent);
            const contactEmail = '10mvpsin20days@gmail.com';
            policyTitle.textContent = t[type];
            let policyContent = `<p>Last updated: July 8, 2024</p><p>For any questions, please contact us at <a href="mailto:${contactEmail}">${contactEmail}</a>.</p>`;
            if (type === 'privacy') {
                policyContent += `<p>We use Google Analytics to collect anonymous data about website usage to improve our service. This data is not personally identifiable. You can accept or decline this via the cookie consent banner. We do not sell or share your data with third parties.</p>`;
            } else {
                policyContent += `<p>By using this service, you agree to use it for educational purposes only. You agree not to reproduce or distribute the content without permission.</p>`;
            }
            policyText.innerHTML = policyContent;
            policyModalOverlay.style.display = 'flex';
        }

        function showResetConfirmModal() {
            resetConfirmModalOverlay.style.display = 'flex';
        }

        function resetProgress() {
            localStorage.removeItem('nvcCourseProgress');
            localStorage.removeItem('nvcCourseWelcomedV2');
            localStorage.removeItem('cookieConsent');
            location.reload();
        }

        function init() {
            loadData();
            setTheme(state.theme); 
            setLanguage(state.lang);
            
            supportLink.href = "https://revolut.me/yonatahf89";
            
            const cookieConsent = localStorage.getItem('cookieConsent');
            if (cookieConsent === 'true') {
                gtag('config', 'G-M27LTF4SQG');
            } else if (!cookieConsent) {
                cookieBanner.style.display = 'flex';
            }
            
            // Default to Hebrew, skip welcome modal for faster start
            if (false && !localStorage.getItem('nvcCourseWelcomedV2')) {
                welcomeModalOverlay.style.display = 'flex';
            } else {
                render();
            }
            
            langBtnEn.addEventListener('click', () => setLanguage('en'));
            langBtnHe.addEventListener('click', () => setLanguage('he'));
            startCourseBtn.addEventListener('click', () => {
                welcomeModalOverlay.style.display = 'none';
                localStorage.setItem('nvcCourseWelcomedV2', 'true');
                saveData();
                render();
            });

            // Footer and Modal Listeners
            termsLink.addEventListener('click', (e) => { e.preventDefault(); showPolicy('terms'); });
            privacyLink.addEventListener('click', (e) => { e.preventDefault(); showPolicy('privacy'); });
            closePolicyBtn.addEventListener('click', () => { policyModalOverlay.style.display = 'none'; });

            // Cookie Listeners
            acceptCookiesBtn.addEventListener('click', () => {
                localStorage.setItem('cookieConsent', 'true');
                cookieBanner.style.display = 'none';
                gtag('config', 'G-M27LTF4SQG');
            });
            declineCookiesBtn.addEventListener('click', () => {
                localStorage.setItem('cookieConsent', 'false');
                cookieBanner.style.display = 'none';
            });
            
            // Reset Listeners
            confirmResetBtn.addEventListener('click', resetProgress);
            cancelResetBtn.addEventListener('click', () => { resetConfirmModalOverlay.style.display = 'none'; });

            // Other Listeners
            const firstInteraction = () => { initAudio(); document.body.removeEventListener('click', firstInteraction); document.body.removeEventListener('touchstart', firstInteraction); };
            document.body.addEventListener('click', firstInteraction);
            document.body.addEventListener('touchstart', firstInteraction);
            soundToggle.addEventListener('click', () => { initAudio(); state.isMuted = !state.isMuted; updateUI(); saveData(); });
            themeToggle.addEventListener('click', () => setTheme(state.theme === 'light' ? 'dark' : 'light'));
        }
        
        init();
    </script>
</body>
</html>
ï¿½
